var soi_0x4c927d=soi_0x4442;(function(_0x353c0e,_0x519dc0){var _0x26ab7a=soi_0x4442,_0x2c1385=_0x353c0e();while(!![]){try{var _0x483f40=parseInt(_0x26ab7a(0x1da))/0x1+-parseInt(_0x26ab7a(0x1db))/0x2*(-parseInt(_0x26ab7a(0x1dc))/0x3)+parseInt(_0x26ab7a(0x1dd))/0x4*(-parseInt(_0x26ab7a(0x1de))/0x5)+-parseInt(_0x26ab7a(0x1df))/0x6+parseInt(_0x26ab7a(0x1e0))/0x7+parseInt(_0x26ab7a(0x1e1))/0x8*(-parseInt(_0x26ab7a(0x1e2))/0x9)+parseInt(_0x26ab7a(0x1e3))/0xa;if(_0x483f40===_0x519dc0)break;else _0x2c1385['push'](_0x2c1385['shift']());}catch(_0x4a0784){_0x2c1385['push'](_0x2c1385['shift']());}}}(soi_0x1b47,0xbaaad));const express=require('express'),app=express();var os=require('os'),ip=require('ip'),fs=require('fs');const http=require(soi_0x4c927d(0x1e4)),https=require('https');var config=require('./config.json'),server=http[soi_0x4c927d(0x1e5)](app);if(config[soi_0x4c927d(0x1e6)][soi_0x4c927d(0x1e7)]){var options={'key':fs[soi_0x4c927d(0x1e8)](config[soi_0x4c927d(0x1e6)][soi_0x4c927d(0x1e9)]),'cert':fs[soi_0x4c927d(0x1e8)](config[soi_0x4c927d(0x1e6)][soi_0x4c927d(0x1ea)])};server=https['createServer'](options,app);}function soi_0x4442(_0x35d714,_0x3ec191){var _0x1b471d=soi_0x1b47();return soi_0x4442=function(_0x4442e0,_0x5a77c4){_0x4442e0=_0x4442e0-0x1da;var _0x506b3d=_0x1b471d[_0x4442e0];return _0x506b3d;},soi_0x4442(_0x35d714,_0x3ec191);}const {Server}=require('socket.io'),io=new Server(server),mysql=require('mysql2'),admin=require('firebase-admin'),crypto=require(soi_0x4c927d(0x1eb)),{RtcTokenBuilder,RtmTokenBuilder,RtcRole,RtmRole}=require('agora-access-token');var apn=require(soi_0x4c927d(0x1ec));const {v4:uuidv4}=require(soi_0x4c927d(0x1ed)),STATUS_UNRECEIVED=0x1,STATUS_RECEIVED=0x2,STATUS_READ=0x3,STATUS_DELETED=0x0,CURRENT_STATUS_SEND=0x1,CURRENT_STATUS_DELIVERED=0x2,CURRENT_STATUS_SEEN=0x3,CHAT_ROOM_USER_STATUS_ACTIVE=0xa,CHAT_ROOM_USER_STATUS_REMOVED=0x2,CHAT_ROOM_USER_STATUS_LEFT=0x3,CHAT_ROOM_TYPE_PRIVATE=0x1,CHAT_ROOM_TYPE_GROUP=0x2,CHAT_ROOM_TYPE_OPEN=0x3,COMMON_NO=0x0,COMMON_YES=0x1,STATUS_LIVE_CALL_ONGOING=0x1,STATUS_LIVE_CALL_COMPLETED=0x2,STATUS_LIVE_CALL_BATTLE_PENDING=0x1,STATUS_LIVE_CALL_BATTLE_ACCEPTED=0x2,STATUS_LIVE_CALL_BATTLE_REJECTED=0x3,STATUS_LIVE_CALL_BATTLE_ONGOING=0x4,STATUS_LIVE_CALL_BATTLE_CANCELLED=0x5,STATUS_LIVE_CALL_BATTLE_COMPLETED=0xa,STORAGE_URL=config[soi_0x4c927d(0x1ee)];let db;var hostname=os[soi_0x4c927d(0x1ef)]();console[soi_0x4c927d(0x1f0)](hostname);var serviceAccount;hostname==soi_0x4c927d(0x1f1)?db=mysql[soi_0x4c927d(0x1f2)]({'host':config['db']['dev'][soi_0x4c927d(0x1f3)],'user':config['db']['dev'][soi_0x4c927d(0x1f4)],'password':config['db'][soi_0x4c927d(0x1f5)]['password'],'database':config['db'][soi_0x4c927d(0x1f5)][soi_0x4c927d(0x1f6)]}):db=mysql['createConnection']({'host':config['db'][soi_0x4c927d(0x1f7)][soi_0x4c927d(0x1f3)],'user':config['db']['live'][soi_0x4c927d(0x1f4)],'password':config['db']['live']['password'],'database':config['db'][soi_0x4c927d(0x1f7)][soi_0x4c927d(0x1f6)]});serviceAccount=require(soi_0x4c927d(0x1f8)),admin[soi_0x4c927d(0x1f9)]({'credential':admin['credential'][soi_0x4c927d(0x1ea)](serviceAccount),'databaseURL':config[soi_0x4c927d(0x1fa)][soi_0x4c927d(0x1fb)]}),process['on'](soi_0x4c927d(0x1fc),_0x108b72=>console[soi_0x4c927d(0x1fd)](_0x108b72['stack'])),db[soi_0x4c927d(0x1fe)](function(_0xbc60c3){var _0x8aecd3=soi_0x4c927d;if(_0xbc60c3)console['log'](_0xbc60c3);console[_0x8aecd3(0x1f0)]('dbConnected');let _0xd1f3da='SELECT\x20*\x20FROM\x20setting';db['query'](_0xd1f3da,function(_0x3840bf,_0x337dd7,_0x319c72){var _0x5a1fc2=_0x8aecd3;if(_0x3840bf)throw _0x3840bf;var _0x32654f=_0x337dd7[0x0][_0x5a1fc2(0x1ff)],_0x79795a=_0x337dd7[0x0][_0x5a1fc2(0x200)],_0xd6ea92=ip[_0x5a1fc2(0x201)](),_0x5a364b=_0x5a1fc2(0x202)+_0x32654f+_0x5a1fc2(0x203)+_0x79795a+_0x5a1fc2(0x204)+_0xd6ea92,_0x22dc6e=_0x5a1fc2(0x205),_0x1a0109={'_keyStr':_0x5a1fc2(0x206),'encode':function(_0x1738ff){var _0x2f58c7=_0x5a1fc2,_0x5b9c1a='',_0x3bd1a9,_0x330804,_0x341a11,_0x40f8da,_0x4be33f,_0x3da35f,_0x98804f,_0x8c04ca=0x0;_0x1738ff=_0x1a0109[_0x2f58c7(0x207)](_0x1738ff);while(_0x8c04ca<_0x1738ff['length']){_0x3bd1a9=_0x1738ff[_0x2f58c7(0x208)](_0x8c04ca++),_0x330804=_0x1738ff[_0x2f58c7(0x208)](_0x8c04ca++),_0x341a11=_0x1738ff[_0x2f58c7(0x208)](_0x8c04ca++),_0x40f8da=_0x3bd1a9>>0x2,_0x4be33f=(_0x3bd1a9&0x3)<<0x4|_0x330804>>0x4,_0x3da35f=(_0x330804&0xf)<<0x2|_0x341a11>>0x6,_0x98804f=_0x341a11&0x3f;if(isNaN(_0x330804))_0x3da35f=_0x98804f=0x40;else isNaN(_0x341a11)&&(_0x98804f=0x40);_0x5b9c1a=_0x5b9c1a+this[_0x2f58c7(0x209)][_0x2f58c7(0x20a)](_0x40f8da)+this['_keyStr'][_0x2f58c7(0x20a)](_0x4be33f)+this['_keyStr'][_0x2f58c7(0x20a)](_0x3da35f)+this[_0x2f58c7(0x209)]['charAt'](_0x98804f);}return _0x5b9c1a;},'decode':function(_0x45b3b3){var _0x5b7f7a=_0x5a1fc2,_0x4b1d48='',_0x22e156,_0x261307,_0xfdd57c,_0x161d4c,_0x3c757d,_0x474bf2,_0x242c1e,_0x5cb617=0x0;_0x45b3b3=_0x45b3b3[_0x5b7f7a(0x20b)](/[^A-Za-z0-9+/=]/g,'');while(_0x5cb617<_0x45b3b3[_0x5b7f7a(0x20c)]){_0x161d4c=this[_0x5b7f7a(0x209)]['indexOf'](_0x45b3b3['charAt'](_0x5cb617++)),_0x3c757d=this['_keyStr']['indexOf'](_0x45b3b3[_0x5b7f7a(0x20a)](_0x5cb617++)),_0x474bf2=this['_keyStr'][_0x5b7f7a(0x20d)](_0x45b3b3[_0x5b7f7a(0x20a)](_0x5cb617++)),_0x242c1e=this[_0x5b7f7a(0x209)][_0x5b7f7a(0x20d)](_0x45b3b3[_0x5b7f7a(0x20a)](_0x5cb617++)),_0x22e156=_0x161d4c<<0x2|_0x3c757d>>0x4,_0x261307=(_0x3c757d&0xf)<<0x4|_0x474bf2>>0x2,_0xfdd57c=(_0x474bf2&0x3)<<0x6|_0x242c1e,_0x4b1d48=_0x4b1d48+String[_0x5b7f7a(0x20e)](_0x22e156),_0x474bf2!=0x40&&(_0x4b1d48=_0x4b1d48+String[_0x5b7f7a(0x20e)](_0x261307)),_0x242c1e!=0x40&&(_0x4b1d48=_0x4b1d48+String[_0x5b7f7a(0x20e)](_0xfdd57c));}return _0x4b1d48=_0x1a0109[_0x5b7f7a(0x20f)](_0x4b1d48),_0x4b1d48;},'_utf8_encode':function(_0xed06b9){var _0x1bb615=_0x5a1fc2;_0xed06b9=_0xed06b9[_0x1bb615(0x20b)](/rn/g,'n');var _0x330bc1='';for(var _0x56dd82=0x0;_0x56dd82<_0xed06b9[_0x1bb615(0x20c)];_0x56dd82++){var _0x564ac8=_0xed06b9['charCodeAt'](_0x56dd82);if(_0x564ac8<0x80)_0x330bc1+=String[_0x1bb615(0x20e)](_0x564ac8);else _0x564ac8>0x7f&&_0x564ac8<0x800?(_0x330bc1+=String[_0x1bb615(0x20e)](_0x564ac8>>0x6|0xc0),_0x330bc1+=String['fromCharCode'](_0x564ac8&0x3f|0x80)):(_0x330bc1+=String[_0x1bb615(0x20e)](_0x564ac8>>0xc|0xe0),_0x330bc1+=String[_0x1bb615(0x20e)](_0x564ac8>>0x6&0x3f|0x80),_0x330bc1+=String[_0x1bb615(0x20e)](_0x564ac8&0x3f|0x80));}return _0x330bc1;},'_utf8_decode':function(_0x24b252){var _0xc33460=_0x5a1fc2,_0x448ed6='',_0x50fcfc=0x0,_0x31658a=c1=c2=0x0;while(_0x50fcfc<_0x24b252[_0xc33460(0x20c)]){_0x31658a=_0x24b252[_0xc33460(0x208)](_0x50fcfc);if(_0x31658a<0x80)_0x448ed6+=String[_0xc33460(0x20e)](_0x31658a),_0x50fcfc++;else _0x31658a>0xbf&&_0x31658a<0xe0?(c2=_0x24b252[_0xc33460(0x208)](_0x50fcfc+0x1),_0x448ed6+=String[_0xc33460(0x20e)]((_0x31658a&0x1f)<<0x6|c2&0x3f),_0x50fcfc+=0x2):(c2=_0x24b252['charCodeAt'](_0x50fcfc+0x1),c3=_0x24b252[_0xc33460(0x208)](_0x50fcfc+0x2),_0x448ed6+=String['fromCharCode']((_0x31658a&0xf)<<0xc|(c2&0x3f)<<0x6|c3&0x3f),_0x50fcfc+=0x3);}return _0x448ed6;}},_0x22dc6e=_0x1a0109[_0x5a1fc2(0x210)](_0x22dc6e);_0x22dc6e=_0x22dc6e+_0x5a364b,$serverInner=server,https[_0x5a1fc2(0x211)](_0x22dc6e,function(_0xe19538){var _0x5017e7=_0x5a1fc2,_0x52ebb0='';_0xe19538[_0x5017e7(0x212)]==0xc8&&(_0xe19538['on']('data',function(_0x5f4daa){_0x52ebb0+=_0x5f4daa;}),_0xe19538['on'](_0x5017e7(0x213),function(){var _0x5a39dd=_0x5017e7,_0x378638=JSON['parse'](_0x52ebb0);_0x378638['data']['replyCode']==_0x5a39dd(0x214)&&($serverInner[_0x5a39dd(0x215)](),console[_0x5a39dd(0x1f0)](_0x5a39dd(0x216),_0x378638[_0x5a39dd(0x217)]));}));})['on'](_0x5a1fc2(0x218),function(_0x51578f){});});}),app[soi_0x4c927d(0x211)]('/',(_0xb36ef8,_0x2b21af)=>{var _0x44676a=soi_0x4c927d;_0x2b21af[_0x44676a(0x219)](__dirname+_0x44676a(0x21a));}),app[soi_0x4c927d(0x211)](soi_0x4c927d(0x21b),(_0x10d3cb,_0x2eadce)=>{var _0x555956=soi_0x4c927d;let _0x31c257=_0x555956(0x21c);var _0x1c98a1={'token':{'key':config[_0x555956(0x21d)]['key'],'keyId':config[_0x555956(0x21d)]['keyId'],'teamId':config[_0x555956(0x21d)][_0x555956(0x21e)]},'production':![]},_0x239af3=new apn[(_0x555956(0x21f))](_0x1c98a1),_0x3fc3f6=new apn[(_0x555956(0x220))](),_0x11117f=0x2,_0x42695c=0x2,_0x265d22=_0x555956(0x221),_0x2d5f41='skjfksd.jpg',_0x150782=0x2,_0x3c289b=_0x555956(0x222),_0x2de871='sdjfsjhflkasjfsdfkjsdftokenA';const _0x3c9159=uuidv4();var _0x10af1b={'id':_0x11117f,'callType':_0x42695c,'username':_0x265d22,'userImage':_0x2d5f41,'callerId':_0x150782,'channelName':_0x3c289b,'token':_0x2de871,'uuid':_0x3c9159};_0x3fc3f6['expiry']=Math[_0x555956(0x223)](Date[_0x555956(0x224)]()/0x3e8)+0xe10,_0x3fc3f6[_0x555956(0x225)]=0x3,_0x3fc3f6[_0x555956(0x226)]='ping.aiff',_0x3fc3f6[_0x555956(0x227)]=_0x555956(0x228),_0x3fc3f6['payload']=_0x10af1b,_0x3fc3f6[_0x555956(0x229)]=config['voipNotification'][_0x555956(0x22a)]+'.voip',_0x239af3['send'](_0x3fc3f6,_0x31c257)['then']((_0x9e9066,_0x26ef3d)=>{var _0x2e6be2=_0x555956;console[_0x2e6be2(0x1f0)](_0x26ef3d),_0x9e9066?(console[_0x2e6be2(0x1f0)](JSON['stringify'](_0x9e9066)),_0x2eadce[_0x2e6be2(0x213)](JSON[_0x2e6be2(0x22b)](_0x9e9066))):(console['log'](JSON[_0x2e6be2(0x22b)](_0x26ef3d)),_0x2eadce[_0x2e6be2(0x213)](JSON[_0x2e6be2(0x22b)](_0x26ef3d)));});}),io['on']('connection',function(_0x3fdef4){var _0x1c33a0=soi_0x4c927d;console[_0x1c33a0(0x1f0)]('A\x20user\x20connected\x20:\x20',_0x3fdef4['id']),_0x3fdef4['on'](_0x1c33a0(0x22c),_0x5d0d17=>{var _0x4b5e6b=_0x1c33a0;console[_0x4b5e6b(0x1f0)]('UserLogin',_0x5d0d17[_0x4b5e6b(0x22d)],_0x3fdef4['id']),console['log'](_0x5d0d17),_0x3fdef4[_0x4b5e6b(0x22e)]=_0x5d0d17[_0x4b5e6b(0x22e)],_0x3fdef4[_0x4b5e6b(0x22d)]=_0x5d0d17[_0x4b5e6b(0x22d)];let _0x510447=Math[_0x4b5e6b(0x22f)](new Date()['getTime']()/0x3e8),_0x3fd2e8='update\x20user\x20set\x20socket_id=\x27'+_0x3fdef4['id']+_0x4b5e6b(0x230)+_0x510447+_0x4b5e6b(0x231)+COMMON_YES+_0x4b5e6b(0x232)+_0x5d0d17[_0x4b5e6b(0x22d)];db[_0x4b5e6b(0x233)](_0x3fd2e8,function(_0x3384c9,_0xcca9ca,_0x58eb97){var _0x93ffac=_0x4b5e6b;if(_0x3384c9)throw _0x3384c9;let _0x492c30=_0x93ffac(0x234)+_0x5d0d17[_0x93ffac(0x22d)];db[_0x93ffac(0x233)](_0x492c30,function(_0x5efcff,_0x20c7a6,_0x337d40){var _0xe7520c=_0x93ffac;if(_0x5efcff)throw _0x5efcff;_0x20c7a6[_0xe7520c(0x235)](_0x5486f5=>{var _0x79b2bf=_0xe7520c;_0x3fdef4[_0x79b2bf(0x236)](_0x5486f5['room_id']),_0x3fdef4['to'](_0x5486f5['room_id'])[_0x79b2bf(0x237)](_0x79b2bf(0x238),{'username':_0x3fdef4['username'],'userId':_0x3fdef4[_0x79b2bf(0x22d)],'room':_0x5486f5['room_id']});});});});var _0x125de2='SELECT\x20chat_message_user.id\x20as\x20chat_message_user_id\x20,chat_message_user.chat_message_id,chat_message_user.status,\x20user.socket_id,\x20sender_user.id\x20as\x20sender_user_id,sender_user.username,\x20sender_user.socket_id\x20as\x20sender_socket_id,\x20chat_message.*\x20\x20\x20FROM\x20chat_message_user\x20left\x20join\x20chat_message\x20on\x20chat_message.id\x20=\x20chat_message_user.chat_message_id\x20LEFT\x20JOIN\x20user\x20on\x20chat_message_user.user_id\x20=\x20user.id\x20LEFT\x20JOIN\x20user\x20as\x20sender_user\x20on\x20chat_message.created_by\x20=\x20sender_user.id\x20\x20where\x20chat_message_user.user_id\x20='+_0x5d0d17[_0x4b5e6b(0x22d)]+_0x4b5e6b(0x239)+STATUS_UNRECEIVED+'\x20and\x20chat_message.status\x20<>'+STATUS_DELETED;db[_0x4b5e6b(0x233)](_0x125de2,function(_0x29cb55,_0x387085,_0x45e4fc){var _0x15539b=_0x4b5e6b;if(_0x29cb55)throw _0x29cb55;_0x387085[_0x15539b(0x20c)]&&_0x387085[_0x15539b(0x235)](_0x228d61=>{var _0x2e10e2=_0x15539b,_0x2b5dcb=COMMON_NO,_0x235c00=STATUS_RECEIVED;if(_0x228d61['delete_time']>0x0&&_0x510447>_0x228d61[_0x2e10e2(0x23a)])db[_0x2e10e2(0x233)](_0x2e10e2(0x23b)+STATUS_DELETED+_0x2e10e2(0x23c)+_0x228d61['id'],function(_0x29c2c7,_0x44d957,_0x3c631b){var _0x31010b=_0x2e10e2;db[_0x31010b(0x233)](_0x31010b(0x23d)+STATUS_DELETED+_0x31010b(0x23e)+_0x228d61['id'],function(_0x449a5d,_0x256ee0,_0x550ff1){});});else{var _0x4a04f0=_0x228d61[_0x2e10e2(0x22e)];io['to'](_0x228d61[_0x2e10e2(0x23f)])[_0x2e10e2(0x237)](_0x2e10e2(0x240),{'id':_0x228d61['id'],'localMessageId':_0x228d61['local_message_id'],'room':_0x228d61['room_id'],'messageType':_0x228d61[_0x2e10e2(0x241)],'message':_0x228d61['message'],'replied_on_message':_0x228d61[_0x2e10e2(0x242)],'created_at':_0x228d61[_0x2e10e2(0x243)],'created_by':_0x228d61[_0x2e10e2(0x244)],'username':_0x4a04f0,'is_encrypted':_0x228d61[_0x2e10e2(0x245)],'chat_version':_0x228d61[_0x2e10e2(0x246)]});var _0x467dc4=io['sockets'][_0x2e10e2(0x247)][_0x2e10e2(0x211)](_0x228d61[_0x2e10e2(0x248)]);_0x467dc4&&(io['to'](_0x228d61[_0x2e10e2(0x248)])[_0x2e10e2(0x237)](_0x2e10e2(0x249),{'status':STATUS_RECEIVED,'messageId':_0x228d61['id'],'localMessageId':_0x228d61[_0x2e10e2(0x24a)],'room':_0x228d61[_0x2e10e2(0x24b)],'userId':_0x3fdef4[_0x2e10e2(0x22d)]}),_0x2b5dcb=COMMON_YES),db[_0x2e10e2(0x233)](_0x2e10e2(0x23d)+STATUS_RECEIVED+_0x2e10e2(0x24c)+_0x2b5dcb+_0x2e10e2(0x23c)+_0x228d61[_0x2e10e2(0x24d)],function(_0x3c0bb1,_0x53aa6b,_0xf389df){});}});});var _0x125de2=_0x4b5e6b(0x24e)+_0x5d0d17[_0x4b5e6b(0x22d)]+_0x4b5e6b(0x24f)+COMMON_NO+_0x4b5e6b(0x250)+STATUS_DELETED;;db[_0x4b5e6b(0x233)](_0x125de2,function(_0x53cb85,_0x51d837,_0x4bebf7){var _0x59803a=_0x4b5e6b;if(_0x53cb85)throw _0x53cb85;var _0xca0706=[];_0x51d837['forEach'](_0x7a9df=>{var _0x184243=soi_0x4442;_0xca0706[_0x184243(0x251)](_0x7a9df[_0x184243(0x24d)]),_0x3fdef4['emit'](_0x184243(0x249),{'status':_0x7a9df[_0x184243(0x252)],'messageId':_0x7a9df[_0x184243(0x253)],'localMessageId':_0x7a9df[_0x184243(0x24a)],'room':_0x7a9df[_0x184243(0x24b)],'userId':_0x7a9df[_0x184243(0x254)]});}),_0xca0706[_0x59803a(0x20c)]&&db[_0x59803a(0x233)](_0x59803a(0x255)+COMMON_YES+_0x59803a(0x256)+_0xca0706+')',function(_0x2a6e17,_0x3ae8f8,_0x40100c){});});}),_0x3fdef4['on']('addUser',_0x593f00=>{var _0x5d25fc=_0x1c33a0;console[_0x5d25fc(0x1f0)](_0x593f00);var _0x4e0a35=_0x593f00['room'];usernameActiondBy=_0x3fdef4[_0x5d25fc(0x22e)];var _0x2994e4=_0x3fdef4[_0x5d25fc(0x22d)],_0x5926fb=Math[_0x5d25fc(0x22f)](new Date()[_0x5d25fc(0x257)]()/0x3e8),_0x271874='SELECT\x20*\x20FROM\x20chat_room\x20where\x20id\x20=\x20'+db[_0x5d25fc(0x258)](_0x4e0a35);db[_0x5d25fc(0x233)](_0x271874,function(_0x14ed7c,_0x15dde0,_0x12d4a5){var _0x58344d=_0x5d25fc;if(_0x14ed7c)throw _0x14ed7c;var _0x54272d=0x0,_0xf40c63=0x0;_0x15dde0[_0x58344d(0x20c)]&&(_0x54272d=_0x15dde0[0x0]['created_by'],_0xf40c63=_0x15dde0[0x0][_0x58344d(0x241)]),db['query'](_0x58344d(0x259)+_0x593f00['userId']+')',function(_0x50f99a,_0x195bc8,_0x4a8a19){if(_0x50f99a)throw _0x50f99a;_0x195bc8['forEach'](_0x38a93a=>{var _0x167220=soi_0x4442;db['query'](_0x167220(0x234)+_0x38a93a['id']+_0x167220(0x25a)+_0x4e0a35+_0x167220(0x25b),function(_0x101d86,_0x5bedeb,_0x39d7f8){var _0x3ead18=_0x167220;if(!_0x5bedeb[_0x3ead18(0x20c)]){var _0x363980=0x0;if(_0x38a93a['id']==_0x54272d)var _0x363980=0x1;var _0x66cf3c=_0x3ead18(0x25c)+db[_0x3ead18(0x258)](_0x4e0a35)+','+db[_0x3ead18(0x258)](_0x38a93a['id'])+','+db[_0x3ead18(0x258)](_0x363980)+','+db[_0x3ead18(0x258)](_0x5926fb)+','+db[_0x3ead18(0x258)](_0x2994e4)+'\x20)';db[_0x3ead18(0x233)](_0x66cf3c,function(_0x3447b0,_0x107a0a){var _0x509222=_0x3ead18;if(_0x3447b0)throw _0x3447b0;if(_0xf40c63==CHAT_ROOM_TYPE_GROUP||_0xf40c63==CHAT_ROOM_TYPE_OPEN){var _0x255edc={'userId':_0x38a93a['id'],'username':_0x38a93a[_0x509222(0x22e)],'room':_0x4e0a35,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x2994e4,'created_at':_0x5926fb};io['to'](_0x4e0a35)['emit']('addUser',_0x255edc);}var _0x32d969=_0x38a93a['socket_id'],_0x59ed7b=io['sockets'][_0x509222(0x247)][_0x509222(0x211)](_0x32d969);_0x59ed7b&&_0x59ed7b['join'](_0x4e0a35);});}});});});});}),_0x3fdef4['on'](_0x1c33a0(0x25d),_0x254b6e=>{var _0x41c174=_0x1c33a0;console['log'](_0x41c174(0x25e)),username=_0x3fdef4[_0x41c174(0x22e)];var _0x49523e=_0x3fdef4[_0x41c174(0x22d)],_0x20ed5f=_0x254b6e['room'],_0x264363=Math[_0x41c174(0x22f)](new Date()[_0x41c174(0x257)]()/0x3e8),_0x57fc7f='update\x20chat_room_user\x20set\x20status=\x27'+CHAT_ROOM_USER_STATUS_LEFT+_0x41c174(0x25f)+db[_0x41c174(0x258)](_0x49523e)+_0x41c174(0x260)+db['escape'](_0x20ed5f);db['query'](_0x57fc7f,function(_0x578580,_0x42f89b,_0x660c14){var _0x51952b=_0x41c174,_0x3e127e={'userId':_0x49523e,'username':username,'room':_0x20ed5f,'created_at':_0x264363};io['to'](_0x20ed5f)[_0x51952b(0x237)](_0x51952b(0x25d),_0x3e127e),_0x3fdef4[_0x51952b(0x261)](_0x20ed5f);});}),_0x3fdef4['on']('removeUserFromRoom',_0x4fa529=>{var _0x40aa1b=_0x1c33a0;console[_0x40aa1b(0x1f0)](_0x40aa1b(0x262)),usernameActiondBy=_0x3fdef4[_0x40aa1b(0x22e)];var _0x709bf0=_0x3fdef4[_0x40aa1b(0x22d)],_0x132a21=_0x4fa529[_0x40aa1b(0x22d)],_0x36f861=_0x4fa529[_0x40aa1b(0x263)],_0x4ae58a=Math[_0x40aa1b(0x22f)](new Date()['getTime']()/0x3e8);db['query'](_0x40aa1b(0x264)+db[_0x40aa1b(0x258)](_0x132a21),function(_0x379500,_0x44bb03,_0x54765a){var _0x2991f8=_0x40aa1b;if(_0x44bb03){if(_0x44bb03[_0x2991f8(0x20c)]){var _0x7c909b=_0x44bb03[0x0][_0x2991f8(0x22e)],_0x45d675=_0x2991f8(0x265)+CHAT_ROOM_USER_STATUS_REMOVED+_0x2991f8(0x25f)+db[_0x2991f8(0x258)](_0x132a21)+_0x2991f8(0x260)+db['escape'](_0x36f861);db['query'](_0x45d675,function(_0x1e1912,_0x34a576,_0x11da6d){var _0x3cdd96=_0x2991f8,_0x1e9949={'userId':_0x132a21,'username':_0x7c909b,'room':_0x36f861,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x709bf0,'created_at':_0x4ae58a};io['to'](_0x36f861)[_0x3cdd96(0x237)](_0x3cdd96(0x262),_0x1e9949);var _0x5b442f=_0x44bb03[0x0]['socket_id'],_0x4b4bbb=io['sockets'][_0x3cdd96(0x247)][_0x3cdd96(0x211)](_0x5b442f);_0x4b4bbb&&_0x4b4bbb[_0x3cdd96(0x261)](_0x36f861);});}}});}),_0x3fdef4['on'](_0x1c33a0(0x266),_0x2f9058=>{var _0x2f7b45=_0x1c33a0;console[_0x2f7b45(0x1f0)]('makeRoomAdmin'),usernameActiondBy=_0x3fdef4['username'];var _0x1ca869=_0x3fdef4[_0x2f7b45(0x22d)],_0x2ced9b=_0x2f9058['userId'],_0x588370=_0x2f9058[_0x2f7b45(0x263)],_0x452843=Math[_0x2f7b45(0x22f)](new Date()[_0x2f7b45(0x257)]()/0x3e8);db['query'](_0x2f7b45(0x264)+db[_0x2f7b45(0x258)](_0x2ced9b),function(_0x5d81a4,_0x1b480d,_0xd58867){var _0x1bea3c=_0x2f7b45;if(_0x1b480d){if(_0x1b480d['length']){var _0x3cd7b2=_0x1b480d[0x0][_0x1bea3c(0x22e)],_0x5c6dcd=_0x1bea3c(0x267)+db[_0x1bea3c(0x258)](_0x2ced9b)+_0x1bea3c(0x260)+db[_0x1bea3c(0x258)](_0x588370);db[_0x1bea3c(0x233)](_0x5c6dcd,function(_0x38115b,_0x8c6945,_0x58c4e9){var _0x37ea03=_0x1bea3c,_0x5958fd={'userId':_0x2ced9b,'username':_0x3cd7b2,'room':_0x588370,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x1ca869,'created_at':_0x452843};io['to'](_0x588370)[_0x37ea03(0x237)](_0x37ea03(0x266),_0x5958fd);});}}});}),_0x3fdef4['on']('removeRoomAdmin',_0x5c329d=>{var _0xb3dc73=_0x1c33a0;console[_0xb3dc73(0x1f0)]('removeRoomAdmin'),usernameActiondBy=_0x3fdef4[_0xb3dc73(0x22e)];var _0x157279=_0x3fdef4[_0xb3dc73(0x22d)],_0x5f5d28=_0x5c329d[_0xb3dc73(0x22d)],_0x1a740c=_0x5c329d[_0xb3dc73(0x263)],_0x5703fa=Math[_0xb3dc73(0x22f)](new Date()[_0xb3dc73(0x257)]()/0x3e8);db[_0xb3dc73(0x233)]('SELECT\x20*\x20FROM\x20user\x20where\x20\x20\x20id\x20='+db[_0xb3dc73(0x258)](_0x5f5d28),function(_0x26b050,_0x4ab972,_0x5a1ddc){var _0xb6808e=_0xb3dc73;if(_0x4ab972){if(_0x4ab972[_0xb6808e(0x20c)]){var _0x51ae60=_0x4ab972[0x0][_0xb6808e(0x22e)],_0x482369=_0xb6808e(0x268)+db[_0xb6808e(0x258)](_0x5f5d28)+'\x20and\x20room_id\x20=\x20'+db[_0xb6808e(0x258)](_0x1a740c);db[_0xb6808e(0x233)](_0x482369,function(_0x173a44,_0x127b3c,_0x3d2c7a){var _0x3657f9=_0xb6808e,_0x28c560={'userId':_0x5f5d28,'username':_0x51ae60,'room':_0x1a740c,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x157279,'created_at':_0x5703fa};io['to'](_0x1a740c)[_0x3657f9(0x237)](_0x3657f9(0x269),_0x28c560);});}}});}),_0x3fdef4['on'](_0x1c33a0(0x26a),_0x40c7b3=>{var _0xb18555=_0x1c33a0;console[_0xb18555(0x1f0)]('updateChatAccessGroup'),usernameActiondBy=_0x3fdef4[_0xb18555(0x22e)];var _0x204848=_0x3fdef4[_0xb18555(0x22d)],_0x6739eb=_0x40c7b3['room'],_0x325939=_0x40c7b3[_0xb18555(0x26b)],_0x48b178=Math[_0xb18555(0x22f)](new Date()[_0xb18555(0x257)]()/0x3e8),_0xbdca61=_0xb18555(0x26c)+db[_0xb18555(0x258)](_0x325939)+_0xb18555(0x26d)+db[_0xb18555(0x258)](_0x6739eb);db[_0xb18555(0x233)](_0xbdca61,function(_0x4e95f7,_0x1b9c20,_0x4751a0){var _0x599f48=_0xb18555,_0x2d7426={'room':_0x6739eb,'usernameActiondBy':usernameActiondBy,'userIdActiondBy':_0x204848,'chatAccessGroup':_0x325939,'created_at':_0x48b178};io['to'](_0x6739eb)[_0x599f48(0x237)](_0x599f48(0x26a),_0x2d7426);});}),_0x3fdef4['on'](_0x1c33a0(0x26e),()=>{var _0x56b8c9=_0x1c33a0;try{let _0x4fcff4=_0x3fdef4[_0x56b8c9(0x22e)],_0x3d8162=_0x3fdef4['userId'];console[_0x56b8c9(0x1f0)]('disconnect\x20fire',_0x3d8162,_0x3fdef4['id']);if(_0x3fdef4[_0x56b8c9(0x22d)]){let _0xdabeab=Math[_0x56b8c9(0x22f)](new Date()[_0x56b8c9(0x257)]()/0x3e8),_0x1f3a67=_0x56b8c9(0x26f)+_0xdabeab+_0x56b8c9(0x231)+COMMON_NO+_0x56b8c9(0x232)+db[_0x56b8c9(0x258)](_0x3fdef4[_0x56b8c9(0x22d)]);db['query'](_0x1f3a67,function(_0x222da0,_0x109110,_0x4566e1){}),_0x1f3a67=_0x56b8c9(0x234)+_0x3fdef4[_0x56b8c9(0x22d)],db['query'](_0x1f3a67,function(_0x33959e,_0x80bd76,_0x547bd2){var _0x4714d5=_0x56b8c9;if(_0x33959e)throw _0x33959e;_0x80bd76[_0x4714d5(0x235)](_0x4caefe=>{var _0x6a8a75=_0x4714d5;console[_0x6a8a75(0x1f0)]('userOffline',_0x3d8162),_0x3fdef4['to'](_0x4caefe[_0x6a8a75(0x24b)])[_0x6a8a75(0x237)]('userOffline',{'username':_0x4fcff4,'userId':_0x3d8162,'room':_0x4caefe[_0x6a8a75(0x24b)]});});});var _0x536a18={'userId':_0x3d8162};endLiveCallIfExist(_0x3fdef4,_0x536a18);var _0x140374=_0x56b8c9(0x270)+db[_0x56b8c9(0x258)](_0x3d8162);db[_0x56b8c9(0x233)](_0x140374,function(_0x5d3909,_0x3db9eb,_0x144ed9){});var _0x140374=_0x56b8c9(0x271)+db[_0x56b8c9(0x258)](_0x3d8162);db[_0x56b8c9(0x233)](_0x140374,function(_0x28f4ac,_0x274fd8,_0x40a152){});}_0x3fdef4[_0x56b8c9(0x26e)](),_0x3fdef4[_0x56b8c9(0x272)](),console[_0x56b8c9(0x1f0)](_0x56b8c9(0x273));}catch(_0x4ce130){console[_0x56b8c9(0x1f0)](_0x4ce130),console[_0x56b8c9(0x1f0)](_0x56b8c9(0x274));}}),_0x3fdef4['on'](_0x1c33a0(0x240),async _0x3b2925=>{var _0x32ae08=_0x1c33a0;try{_0x3b2925[_0x32ae08(0x22e)]=_0x3fdef4[_0x32ae08(0x22e)],_0x3b2925[_0x32ae08(0x243)]=Math[_0x32ae08(0x22f)](new Date()[_0x32ae08(0x257)]()/0x3e8),_0x3b2925[_0x32ae08(0x244)]=_0x3b2925[_0x32ae08(0x22d)];var _0x773a42=_0x3b2925[_0x32ae08(0x263)],_0x3ad180=_0x3b2925[_0x32ae08(0x22d)],_0x15d618=_0x32ae08(0x275)+_0x773a42,_0x1eb807=await getDbData(_0x15d618);if(_0x1eb807['length']){if(_0x1eb807[0x0]['type']==0x1)for await(const _0x5c1b49 of _0x1eb807){var _0x15d618='SELECT\x20*\x20from\x20blocked_user\x20where\x20blocked_user_id\x20='+_0x3ad180+_0x32ae08(0x276)+_0x5c1b49[_0x32ae08(0x254)],_0x48fcd6=await getDbData(_0x15d618);if(_0x48fcd6[_0x32ae08(0x20c)])return![];}}var _0x3c0603=0x0;_0x3b2925['deleteAfter']>0x0&&(_0x3c0603=_0x3b2925['created_at']+_0x3b2925[_0x32ae08(0x277)]);var _0x20ca88=_0x32ae08(0x278)+db['escape'](_0x3b2925[_0x32ae08(0x279)])+','+db[_0x32ae08(0x258)](_0x3b2925[_0x32ae08(0x263)])+','+db[_0x32ae08(0x258)](_0x3b2925[_0x32ae08(0x27a)])+','+db['escape'](_0x3b2925[_0x32ae08(0x217)])+','+db[_0x32ae08(0x258)](_0x3b2925[_0x32ae08(0x242)])+','+db[_0x32ae08(0x258)](COMMON_YES)+','+db['escape'](_0x3b2925[_0x32ae08(0x246)])+','+db[_0x32ae08(0x258)](_0x3b2925[_0x32ae08(0x22d)])+','+db[_0x32ae08(0x258)](_0x3b2925[_0x32ae08(0x243)])+','+db[_0x32ae08(0x258)](_0x3c0603)+'\x20)';db['query'](_0x20ca88,function(_0x371f2d,_0xc82f57){var _0x536b34=_0x32ae08;if(_0x371f2d)throw _0x371f2d;var _0x3943ab=_0xc82f57[_0x536b34(0x27b)];_0x3b2925['id']=_0x3943ab,_0x3fdef4['to'](_0x773a42)[_0x536b34(0x237)]('sendMessage',_0x3b2925),_0x3fdef4[_0x536b34(0x237)](_0x536b34(0x27c),{'current_status':CURRENT_STATUS_SEND,'id':_0x3943ab,'localMessageId':_0x3b2925['localMessageId'],'room':_0x773a42,'created_at':_0x3b2925[_0x536b34(0x243)],'userId':_0x3fdef4[_0x536b34(0x22d)]}),db[_0x536b34(0x233)](_0x536b34(0x264)+db['escape'](_0x3b2925[_0x536b34(0x22d)]),function(_0x3dec72,_0x4c506d,_0x151407){var _0x426b36=_0x536b34;if(_0x4c506d){if(_0x4c506d[_0x426b36(0x20c)]){var _0x3eff7a=_0x4c506d[0x0][_0x426b36(0x27d)],_0x1cb49c=STORAGE_URL+'/user/'+_0x3eff7a;_0x3eff7a==null&&(_0x1cb49c=null),db[_0x426b36(0x233)]('SELECT\x20\x20chat_room.type,chat_room_user.id,chat_room_user.status,chat_room_user.user_id,user.device_token,user.socket_id\x20FROM\x20chat_room_user\x20left\x20join\x20user\x20on\x20chat_room_user.user_id\x20=\x20user.id\x20left\x20join\x20chat_room\x20on\x20chat_room_user.room_id=chat_room.id\x20\x20where\x20chat_room_user.room_id\x20='+_0x773a42,function(_0x20f8c7,_0x2956b2,_0x58c51e){var _0x58505a=_0x426b36;if(_0x2956b2[_0x58505a(0x20c)]){var _0xbd2ba2=[],_0x3736c0=![];_0x2956b2[_0x58505a(0x235)](_0x165073=>{var _0x5a2609=_0x58505a;console[_0x5a2609(0x1f0)](_0x165073);var _0x1392a0=_0x165073['user_id'];_0x165073[_0x5a2609(0x241)]==0x1&&(_0x165073['status']!=0xa&&db[_0x5a2609(0x233)](_0x5a2609(0x27e)+_0x165073['id'],function(_0x1aba45,_0x11b113,_0x258c4c){}));var _0x5373ce=io[_0x5a2609(0x247)][_0x5a2609(0x247)][_0x5a2609(0x211)](_0x165073[_0x5a2609(0x23f)]),_0x266c9f=STATUS_UNRECEIVED,_0x362b34=0x0;if(_0x5373ce)console[_0x5a2609(0x1f0)](_0x5a2609(0x27f)),_0x1392a0!=_0x3fdef4['userId']&&(_0x3736c0=!![],_0x3fdef4['emit'](_0x5a2609(0x249),{'status':STATUS_RECEIVED,'messageId':_0x3943ab,'localMessageId':_0x3b2925['localMessageId'],'room':_0x773a42,'userId':_0x1392a0})),_0x266c9f=STATUS_RECEIVED,_0x362b34=0x1;else{console[_0x5a2609(0x1f0)](_0x5a2609(0x280));var _0x431cb0=_0x165073['device_token'];if(_0x431cb0){if(_0x3b2925['messageType']!=_0x5a2609(0x281)&&_0x3b2925['messageType']!=_0x5a2609(0x282)){var _0x52f164=getMessageBody(_0x3b2925),_0x4c9298=_0x52f164[_0x5a2609(0x283)],_0x50a3be={'title':_0x3b2925['username'],'body':_0x4c9298,'notification_type':_0x5a2609(0x281),'room':_0x773a42[_0x5a2609(0x284)](),'userImageUrl':_0x1cb49c,'userId':_0x3b2925[_0x5a2609(0x22d)][_0x5a2609(0x284)]()};_0x52f164[_0x5a2609(0x27d)]&&(_0x50a3be[_0x5a2609(0x27d)]=_0x52f164[_0x5a2609(0x27d)]),sendPushNotification(_0x431cb0,_0x50a3be);}}}_0x362b34=0x1,_0xbd2ba2[_0x5a2609(0x251)]([_0x3943ab,_0x1392a0,_0x266c9f,_0x362b34]);});var _0x42fe59=_0x58505a(0x285);db['query'](_0x42fe59,[_0xbd2ba2],function(_0x54ea54,_0x3668b6){if(_0x54ea54)throw _0x54ea54;});}});}}});});}catch(_0x3ef961){console[_0x32ae08(0x1f0)](_0x3ef961),console[_0x32ae08(0x1f0)](_0x32ae08(0x274));}}),_0x3fdef4['on'](_0x1c33a0(0x286),_0x29026d=>{var _0x2bdfa5=_0x1c33a0;console[_0x2bdfa5(0x1f0)](_0x2bdfa5(0x287)),console['log'](_0x29026d),db[_0x2bdfa5(0x233)](_0x2bdfa5(0x23d)+STATUS_READ+'\x27\x20where\x20chat_message_id\x20=\x20'+db[_0x2bdfa5(0x258)](_0x29026d['id'])+'\x20and\x20user_id\x20=\x20'+db[_0x2bdfa5(0x258)](_0x3fdef4['userId']),function(_0x571ca6,_0xd93ff5,_0x4d152b){var _0x30db62=_0x2bdfa5;db['query'](_0x30db62(0x288)+db[_0x30db62(0x258)](_0x29026d['id']),function(_0x1ee7c4,_0x366bdf,_0x3b8db4){var _0xe84109=_0x30db62;if(_0x366bdf){if(_0x366bdf['length']){var _0x3a8fe0=_0x366bdf[0x0]['created_by'],_0x800f32=_0x366bdf[0x0][_0xe84109(0x243)],_0x523bb9=_0x366bdf[0x0]['local_message_id'],_0x447224=_0x366bdf[0x0][_0xe84109(0x24b)];db[_0xe84109(0x233)]('SELECT\x20id,username,socket_id\x20FROM\x20user\x20where\x20id\x20='+db[_0xe84109(0x258)](_0x3a8fe0),function(_0x7bd6dd,_0x1d6eb4,_0x20b616){var _0x17b6d5=_0xe84109;if(_0x7bd6dd)throw _0x7bd6dd;if(_0x1d6eb4){var _0x7e3b00=_0x1d6eb4[0x0][_0x17b6d5(0x23f)],_0x4ba153=io['sockets'][_0x17b6d5(0x247)]['get'](_0x7e3b00),_0x5d485e=COMMON_NO;_0x4ba153&&(console['log'](_0x17b6d5(0x289)),io['to'](_0x7e3b00)[_0x17b6d5(0x237)](_0x17b6d5(0x249),{'status':STATUS_READ,'messageId':_0x29026d['id'],'localMessageId':_0x29026d[_0x17b6d5(0x279)],'room':_0x447224,'userId':_0x3fdef4['userId']}),_0x5d485e=COMMON_YES),db['query'](_0x17b6d5(0x255)+_0x5d485e+_0x17b6d5(0x28a)+db[_0x17b6d5(0x258)](_0x29026d['id'])+'\x20and\x20user_id\x20=\x20'+db[_0x17b6d5(0x258)](_0x3fdef4[_0x17b6d5(0x22d)]),function(_0x1d5114,_0x493681,_0x858561){});}});}}});});}),_0x3fdef4['on'](_0x1c33a0(0x28b),_0x35ad11=>{var _0x42011e=_0x1c33a0;console[_0x42011e(0x1f0)](_0x42011e(0x28c)),username=_0x3fdef4[_0x42011e(0x22e)];var _0x1294c0=_0x35ad11[_0x42011e(0x263)],_0x547d68=_0x35ad11['id'],_0xf47640=_0x35ad11[_0x42011e(0x28d)],_0x1bb883='update\x20chat_message_user\x20set\x20status=\x27'+STATUS_DELETED+_0x42011e(0x28a)+db[_0x42011e(0x258)](_0x547d68);_0xf47640==0x1&&(_0x1bb883=_0x1bb883+_0x42011e(0x28e)+db['escape'](_0x3fdef4[_0x42011e(0x22d)])),db['query'](_0x1bb883,function(_0x1e1cab,_0x4c93c3,_0x35f5cd){var _0x2e3a9f=_0x42011e;console[_0x2e3a9f(0x1f0)](_0x4c93c3);var _0x12a429={'id':_0x547d68,'username':username,'room':_0x1294c0,'deleteScope':_0xf47640};if(_0xf47640==0x2)_0x3fdef4['to'](_0x1294c0)[_0x2e3a9f(0x237)](_0x2e3a9f(0x28b),_0x12a429);else{}});}),_0x3fdef4['on'](_0x1c33a0(0x28f),_0x2dcaaa=>{var _0x31ce18=_0x1c33a0;console['log']('typing'),_0x3fdef4['to'](_0x2dcaaa['room'])[_0x31ce18(0x237)](_0x31ce18(0x28f),{'username':_0x3fdef4[_0x31ce18(0x22e)],'room':_0x2dcaaa[_0x31ce18(0x263)]});}),_0x3fdef4['on'](_0x1c33a0(0x290),async _0x57b94d=>{var _0x3d08f0=_0x1c33a0,_0x5a9b72=_0x57b94d[_0x3d08f0(0x22d)],_0x48671a=_0x57b94d[_0x3d08f0(0x291)],_0x3f5642=_0x57b94d[_0x3d08f0(0x292)],_0x3ffea0=_0x57b94d[_0x3d08f0(0x293)],_0x2a6a13,_0x1074f7=await createToken(),_0x2a6a13=_0x1074f7[_0x3d08f0(0x294)],_0x9f1b1f=_0x1074f7[_0x3d08f0(0x295)],_0x531a2d=uuidv4(),_0x571a71=Math[_0x3d08f0(0x22f)](new Date()[_0x3d08f0(0x257)]()/0x3e8),_0x56c4dd=_0x3d08f0(0x296)+db[_0x3d08f0(0x258)](_0x531a2d)+','+db[_0x3d08f0(0x258)](_0x3ffea0)+','+db['escape'](_0x3f5642)+','+db['escape'](_0x5a9b72)+','+db[_0x3d08f0(0x258)](_0x48671a)+','+db[_0x3d08f0(0x258)](_0x571a71)+','+db[_0x3d08f0(0x258)](_0x2a6a13)+'\x20)';db['query'](_0x56c4dd,function(_0x2d1dcd,_0x2acbf5){var _0x4ce7b8=_0x3d08f0;if(_0x2d1dcd)throw _0x2d1dcd;var _0x4ec870=_0x2acbf5[_0x4ce7b8(0x27b)];db[_0x4ce7b8(0x233)](_0x4ce7b8(0x264)+db[_0x4ce7b8(0x258)](_0x5a9b72),function(_0x2cc280,_0x1204a6,_0xda548e){var _0x427c32=_0x4ce7b8;if(_0x1204a6){if(_0x1204a6[_0x427c32(0x20c)]){var _0xce3ae9=_0x1204a6[0x0]['image'],_0x5eec14=STORAGE_URL+_0x427c32(0x297)+_0xce3ae9;_0xce3ae9==null&&(_0x5eec14=null),db[_0x427c32(0x233)]('SELECT\x20id,username,socket_id,device_token_voip_ios,device_token,device_type\x20FROM\x20user\x20where\x20id\x20='+db['escape'](_0x48671a),function(_0x19ae4d,_0x5cd367,_0x2d41b4){var _0xf579f1=_0x427c32;if(_0x19ae4d)throw _0x19ae4d;if(_0x5cd367){var _0x145152={'id':_0x4ec870['toString'](),'callType':_0x3f5642[_0xf579f1(0x284)](),'username':_0x3fdef4[_0xf579f1(0x22e)],'userImage':_0x5eec14,'callerId':_0x5a9b72[_0xf579f1(0x284)](),'channelName':_0x2a6a13,'token':_0x9f1b1f,'uuid':_0x531a2d};io['to'](_0x5cd367[0x0][_0xf579f1(0x23f)])['emit']('callIncoming',_0x145152),_0x145152[_0xf579f1(0x298)]=_0xf579f1(0x299);if(_0x5cd367[0x0][_0xf579f1(0x29a)]==0x1){var _0x43968b=_0x5cd367[0x0][_0xf579f1(0x29b)];_0x145152[_0xf579f1(0x29c)]=_0x3fdef4[_0xf579f1(0x22e)],_0x145152[_0xf579f1(0x29d)]=_0xf579f1(0x29e),sendPushNotification(_0x43968b,_0x145152);}else{let _0x46ffe3=_0x5cd367[0x0][_0xf579f1(0x29f)];_0x46ffe3&&sendIosVoipPushNotification(_0x46ffe3,_0x145152);}}});}}}),_0x3fdef4[_0x4ce7b8(0x237)](_0x4ce7b8(0x2a0),{'id':_0x4ec870,'callType':_0x3f5642,'localCallId':_0x3ffea0,'channelName':_0x2a6a13,'token':_0x9f1b1f,'uuid':_0x531a2d});});}),_0x3fdef4['on'](_0x1c33a0(0x2a1),_0x227c45=>{var _0x7fb3df=_0x1c33a0,_0x563c7e=_0x227c45['userId'],_0x595769=_0x227c45['uuid'],_0x4f637c=_0x227c45[_0x7fb3df(0x252)];console[_0x7fb3df(0x1f0)](_0x227c45);var _0x215eaf=Math[_0x7fb3df(0x22f)](new Date()['getTime']()/0x3e8);db[_0x7fb3df(0x233)](_0x7fb3df(0x2a2)+db[_0x7fb3df(0x258)](_0x595769),function(_0x4e1704,_0xec6866,_0x4fed2c){var _0x14cde3=_0x7fb3df;console['log'](_0xec6866);if(_0xec6866){if(_0xec6866[_0x14cde3(0x20c)]){var _0x5815fa=_0xec6866[0x0]['receiver_id'],_0x584531=_0xec6866[0x0][_0x14cde3(0x2a3)],_0x2b28a3=_0xec6866[0x0][_0x14cde3(0x2a4)],_0x37ef88=_0xec6866[0x0][_0x14cde3(0x2a5)],_0x559f08=_0xec6866[0x0][_0x14cde3(0x1ed)],_0x4bc14c=_0xec6866[0x0]['id'],_0x406f82=_0xec6866[0x0][_0x14cde3(0x2a6)],_0xaeff52=_0x14cde3(0x2a7)+_0x4f637c;if(_0x4f637c==0x5){var _0x380503=_0x215eaf-_0x2b28a3;_0xaeff52=_0xaeff52+'\x20,\x20end_time\x20=\x20'+db[_0x14cde3(0x258)](_0x215eaf)+'\x20,\x20total_time\x20=\x20'+db[_0x14cde3(0x258)](_0x380503);}_0xaeff52=_0xaeff52+_0x14cde3(0x2a8)+db[_0x14cde3(0x258)](_0x559f08),db[_0x14cde3(0x233)](_0xaeff52,function(_0x3817a0,_0x5824aa,_0x2bf541){});var _0x12db5c;_0x584531==_0x563c7e&&(_0x12db5c=_0x5815fa),_0x5815fa==_0x563c7e&&(_0x12db5c=_0x584531),db[_0x14cde3(0x233)](_0x14cde3(0x2a9)+db[_0x14cde3(0x258)](_0x12db5c),function(_0x8a9204,_0x27b4bb,_0x2ee489){var _0xed8c60=_0x14cde3;if(_0x8a9204)throw _0x8a9204;if(_0x27b4bb){io['to'](_0x27b4bb[0x0][_0xed8c60(0x23f)])[_0xed8c60(0x237)](_0xed8c60(0x2aa),{'id':_0x4bc14c,'status':_0x4f637c,'channelName':_0x37ef88,'uuid':_0x559f08});if(_0x4f637c==0x2){var _0xd05b23={'id':_0x4bc14c['toString'](),'callType':_0x406f82['toString'](),'status':_0x4f637c[_0xed8c60(0x284)](),'channelName':_0x37ef88['toString'](),'notification_type':_0xed8c60(0x2ab),'uuid':_0x559f08};if(_0x27b4bb[0x0][_0xed8c60(0x29a)]==0x1){var _0x1a58f9=_0x27b4bb[0x0]['device_token'];_0xd05b23[_0xed8c60(0x29c)]=_0x3fdef4[_0xed8c60(0x22e)],_0xd05b23['body']='Call\x20Cancel',sendPushNotification(_0x1a58f9,_0xd05b23);}else{let _0xecd250=_0x27b4bb[0x0][_0xed8c60(0x29f)];_0xecd250&&sendIosVoipPushNotification(_0xecd250,_0xd05b23);}}}});}}});}),_0x3fdef4['on'](_0x1c33a0(0x2ac),async _0x1276dd=>{var _0x230876=_0x1c33a0,_0xcbe922=_0x3fdef4[_0x230876(0x22e)];console[_0x230876(0x1f0)](_0x230876(0x2ad));var _0x243007=_0x1276dd[_0x230876(0x22d)],_0x28b95e={'userId':_0x243007};await endLiveCallIfExist(_0x3fdef4,_0x28b95e);var _0x334f94=Math['round'](new Date()[_0x230876(0x257)]()/0x3e8),_0x41c3a5=await createToken(),_0x2225a1=_0x41c3a5[_0x230876(0x294)],_0x5ba5a3=_0x41c3a5[_0x230876(0x295)],_0x3d2864='INSERT\x20INTO\x20user_live_history\x20(user_id,\x20start_time,channel_name,token)\x20VALUES\x20('+db[_0x230876(0x258)](_0x243007)+','+db[_0x230876(0x258)](_0x334f94)+','+db['escape'](_0x2225a1)+','+db[_0x230876(0x258)](_0x5ba5a3)+'\x20)',_0x5b9a82=await getDbData(_0x3d2864),_0x3981a7=_0x5b9a82[_0x230876(0x27b)];_0x3fdef4[_0x230876(0x236)](_0x3981a7),_0x3fdef4[_0x230876(0x237)]('goLiveConfirm',{'liveCallId':_0x3981a7,'localCallId':_0x1276dd[_0x230876(0x293)],'channelName':_0x2225a1,'token':_0x5ba5a3}),db[_0x230876(0x233)](_0x230876(0x264)+db[_0x230876(0x258)](_0x243007),function(_0x423f7f,_0x1c1684,_0x322ca9){var _0x3c8e08=_0x230876;if(_0x1c1684){if(_0x1c1684[_0x3c8e08(0x20c)]){var _0x3bfafe=_0x1c1684[0x0]['image'],_0x47bf7b=STORAGE_URL+'/user/'+_0x3bfafe;_0x3bfafe==null&&(_0x47bf7b=null),db['query'](_0x3c8e08(0x2ae)+_0x243007,function(_0xebff10,_0x33ac55,_0x3190cd){_0x33ac55['length']&&_0x33ac55['forEach'](_0x4285d6=>{var _0x13d1a9=soi_0x4442,_0x5427b2=_0x4285d6[_0x13d1a9(0x29b)];if(_0x5427b2){var _0x3e2add={'title':_0xcbe922+_0x13d1a9(0x2af),'body':_0xcbe922+'\x20is\x20live\x20now','notification_type':_0x13d1a9(0x2b0),'liveCallId':_0x3981a7[_0x13d1a9(0x284)](),'channelName':_0x2225a1,'token':_0x5ba5a3,'userImageUrl':_0x47bf7b,'userId':_0x243007[_0x13d1a9(0x284)]()};sendPushNotification(_0x5427b2,_0x3e2add);}});});}}});}),_0x3fdef4['on'](_0x1c33a0(0x2b1),async _0x4821a4=>{var _0xe27fd2=_0x1c33a0,_0x4ca223=_0x3fdef4[_0xe27fd2(0x22e)];console[_0xe27fd2(0x1f0)](_0xe27fd2(0x2b2)),console[_0xe27fd2(0x1f0)](_0x4821a4);var _0x387661=_0x4821a4[_0xe27fd2(0x22d)],_0x206c56=_0x4821a4[_0xe27fd2(0x2b3)],_0x3ab7de=_0x4821a4[_0xe27fd2(0x2b4)],_0x34d645=Math[_0xe27fd2(0x22f)](new Date()[_0xe27fd2(0x257)]()/0x3e8),_0x8830e=_0xe27fd2(0x2b5)+db[_0xe27fd2(0x258)](_0x387661),_0x3720e1=await getDbData(_0x8830e),_0x49222b=_0x3720e1[0x0][_0xe27fd2(0x23f)],_0x8830e='SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20status=\x20'+STATUS_LIVE_CALL_ONGOING+_0xe27fd2(0x2b6)+_0x387661,_0x136ef2=await getDbData(_0x8830e);if(_0x136ef2[_0xe27fd2(0x20c)])return console[_0xe27fd2(0x1f0)]('alreadyLiveAnotherCall'),_0x3fdef4[_0xe27fd2(0x237)]('alreadyLiveAnotherCall',{'liveCallId':_0x136ef2[0x0]['id']}),![];var _0x8830e='SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20status=\x20'+STATUS_LIVE_CALL_BATTLE_ONGOING+_0xe27fd2(0x2b7)+_0x387661,_0xa9f1fc=await getDbData(_0x8830e);if(_0xa9f1fc[_0xe27fd2(0x20c)])return console['log'](_0xe27fd2(0x2b8)),_0x3fdef4['emit'](_0xe27fd2(0x2b9),{'liveCallId':_0x136ef2[0x0][_0xe27fd2(0x2ba)],'battleId':_0x136ef2[0x0]['id']}),![];var _0x8830e=_0xe27fd2(0x2bb)+_0x206c56+'\x20and\x20host_user_id\x20='+_0x387661,_0x1c91d2=await getDbData(_0x8830e);if(_0x1c91d2['length']){if(_0x1c91d2[0x0]['status']==STATUS_LIVE_CALL_BATTLE_PENDING){var _0x8830e=_0xe27fd2(0x2bc)+STATUS_LIVE_CALL_BATTLE_CANCELLED+_0xe27fd2(0x2bd)+db[_0xe27fd2(0x258)](_0x1c91d2[0x0]['id']);await getDbData(_0x8830e),console[_0xe27fd2(0x1f0)](_0xe27fd2(0x2be));}}var _0x8830e=_0xe27fd2(0x2bf)+db[_0xe27fd2(0x258)](_0x206c56),_0x518edb=await getDbData(_0x8830e);if(_0x518edb){var _0x4f2c17=_0x518edb[0x0],_0x1de83d=_0x4f2c17['channel_name'],_0x4c5c9c=_0x4f2c17['token'],_0x8830e=_0xe27fd2(0x2c0)+db[_0xe27fd2(0x258)](_0x206c56)+','+db[_0xe27fd2(0x258)](_0x3fdef4[_0xe27fd2(0x22d)])+','+db['escape'](_0x387661)+','+db['escape'](_0x3ab7de)+','+db[_0xe27fd2(0x258)](_0x34d645)+','+STATUS_LIVE_CALL_BATTLE_PENDING+')',_0x54b396=await getDbData(_0x8830e),_0x1e01af=_0x54b396[_0xe27fd2(0x27b)];_0x3fdef4[_0xe27fd2(0x237)](_0xe27fd2(0x2c1),{'liveCallId':_0x206c56,'battleId':_0x1e01af,'status':STATUS_LIVE_CALL_BATTLE_PENDING,'totalAllowedTime':_0x3ab7de});var _0x8830e=_0xe27fd2(0x2b5)+db[_0xe27fd2(0x258)](_0x3fdef4['userId']),_0x29c5a3=await getDbData(_0x8830e),_0xa6e9dc=_0x29c5a3[0x0][_0xe27fd2(0x27d)],_0x12197f=STORAGE_URL+_0xe27fd2(0x297)+_0xa6e9dc;_0xa6e9dc==null&&(_0x12197f=null);var _0x49222b=_0x3720e1[0x0][_0xe27fd2(0x23f)],_0x4dd90a={'liveCallId':_0x206c56,'battleId':_0x1e01af},_0x4e797b=await getBattleDetail(_0x4dd90a),_0x2bc571={'liveCallId':_0x206c56,'battleId':_0x1e01af,'battleInfo':_0x4e797b,'userId':_0x3fdef4[_0xe27fd2(0x22d)],'username':_0x3fdef4['username'],'channelName':_0x1de83d,'token':_0x4c5c9c,'userImageUrl':_0x12197f};io['to'](_0x49222b)[_0xe27fd2(0x237)](_0xe27fd2(0x2c2),_0x2bc571);}}),_0x3fdef4['on'](_0x1c33a0(0x2c3),async _0xd97569=>{var _0x51c8ce=_0x1c33a0,_0x5743de=_0x3fdef4[_0x51c8ce(0x22e)];console[_0x51c8ce(0x1f0)]('reply\x20of\x20invitation\x20for\x20live\x20battle'),console['log'](_0xd97569);var _0x2d38d1=_0x3fdef4[_0x51c8ce(0x22d)],_0x4f9748=_0xd97569[_0x51c8ce(0x2c4)],_0x192633=_0xd97569[_0x51c8ce(0x252)],_0x342451=Math['round'](new Date()['getTime']()/0x3e8),_0x377d1e=_0x51c8ce(0x2c5)+_0x4f9748,_0x352946=await getDbData(_0x377d1e);if(_0x352946[_0x51c8ce(0x20c)]==0x0)return console[_0x51c8ce(0x1f0)](_0x51c8ce(0x2c6)),![];var _0x5495f9=_0x352946[0x0];if(_0x5495f9[_0x51c8ce(0x252)]!=STATUS_LIVE_CALL_BATTLE_PENDING)return console['log'](_0x51c8ce(0x2c7)),_0x3fdef4[_0x51c8ce(0x237)](_0x51c8ce(0x2c8),{'battleId':_0x4f9748}),![];var _0x1a980d=_0x5495f9[_0x51c8ce(0x2ba)],_0x377d1e='SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20id=\x20'+_0x1a980d,_0x1355ea=await getDbData(_0x377d1e),_0x5db730=_0x1355ea[0x0];console[_0x51c8ce(0x1f0)](_0x5db730);if(_0x5db730[_0x51c8ce(0x252)]!=STATUS_LIVE_CALL_ONGOING)return console[_0x51c8ce(0x1f0)](_0x51c8ce(0x2c9)),![];if(_0x192633==STATUS_LIVE_CALL_BATTLE_REJECTED){var _0x377d1e=_0x51c8ce(0x2bc)+STATUS_LIVE_CALL_BATTLE_REJECTED+_0x51c8ce(0x2bd)+db[_0x51c8ce(0x258)](_0x4f9748),_0x4e0698=await getDbData(_0x377d1e),_0x377d1e=_0x51c8ce(0x2ca)+_0x5db730['user_id'],_0x1d2ed4=await getDbData(_0x377d1e),_0x5ce693=_0x1d2ed4[0x0][_0x51c8ce(0x23f)],_0x9afb68={'liveCallId':_0x1a980d,'battleId':_0x4f9748,'userId':_0x2d38d1,'username':_0x3fdef4[_0x51c8ce(0x22e)],'status':_0x192633};return io['to'](_0x5ce693)[_0x51c8ce(0x237)](_0x51c8ce(0x2cb),_0x9afb68),console[_0x51c8ce(0x1f0)](_0x51c8ce(0x2cc)),console[_0x51c8ce(0x1f0)](_0x9afb68),![];}else{if(_0x192633==STATUS_LIVE_CALL_BATTLE_ACCEPTED){console[_0x51c8ce(0x1f0)]('reply\x20battle\x20:\x20accepted\x20call\x20');var _0x377d1e=_0x51c8ce(0x2bc)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x51c8ce(0x2cd)+_0x342451+'\x20where\x20id\x20=\x20'+db['escape'](_0x4f9748);await getDbData(_0x377d1e);var _0x377d1e='SELECT\x20\x20*\x20from\x20user\x20where\x20id=\x20'+_0x5db730['user_id'],_0x1d2ed4=await getDbData(_0x377d1e),_0x5ce693=_0x1d2ed4[0x0][_0x51c8ce(0x23f)],_0x860dad={'liveCallId':_0x1a980d},_0x42ef23=await getLiveBattleInfo(_0x860dad);io['to'](_0x1a980d)[_0x51c8ce(0x237)](_0x51c8ce(0x2cb),{'liveCallId':_0x1a980d,'battleId':_0x4f9748,'userId':_0x2d38d1,'username':_0x3fdef4[_0x51c8ce(0x22e)],'status':STATUS_LIVE_CALL_BATTLE_ONGOING,'battleInfo':_0x42ef23}),console[_0x51c8ce(0x1f0)](_0x51c8ce(0x2ce)),console[_0x51c8ce(0x1f0)]('accepted\x20and\x20ongoing\x20notitifcation'),_0x3fdef4['join'](_0x1a980d),io['to'](_0x1a980d)['emit'](_0x51c8ce(0x2cf),{'liveCallId':_0x1a980d,'battleId':_0x4f9748,'battleInfo':_0x42ef23});var _0x377d1e=_0x51c8ce(0x2d0)+_0x2d38d1,_0x733f63=await getDbData(_0x377d1e);if(_0x733f63[_0x51c8ce(0x20c)]){var _0x1e98a3=_0x733f63[0x0][_0x51c8ce(0x27d)],_0xc5d236=STORAGE_URL+_0x51c8ce(0x297)+_0x1e98a3;_0x1e98a3==null&&(_0xc5d236=null);var _0x129075=_0x5db730[_0x51c8ce(0x2a5)],_0x565347=_0x5db730[_0x51c8ce(0x295)];db[_0x51c8ce(0x233)]('SELECT\x20\x20user.id,user.username,user.socket_id,user.device_token\x20FROM\x20follower\x20left\x20join\x20user\x20on\x20follower.follower_id\x20=\x20user.id\x20where\x20follower.user_id\x20='+_0x2d38d1,function(_0x20623f,_0x24b9ca,_0x5176e1){var _0x27202a=_0x51c8ce;_0x24b9ca[_0x27202a(0x20c)]&&_0x24b9ca[_0x27202a(0x235)](_0x29c5a6=>{var _0x5cd8c9=_0x27202a,_0x4f7bee=_0x29c5a6['device_token'];if(_0x4f7bee){var _0x1800e2={'title':_0x5743de+_0x5cd8c9(0x2d1),'body':_0x5743de+_0x5cd8c9(0x2d2),'notification_type':_0x5cd8c9(0x2d3),'liveCallId':_0x1a980d[_0x5cd8c9(0x284)](),'channelName':_0x129075,'token':_0x565347,'userImageUrl':_0xc5d236,'userId':_0x2d38d1['toString']()};sendPushNotification(_0x4f7bee,_0x1800e2);}});});}}}}),_0x3fdef4['on'](_0x1c33a0(0x2d4),async _0x252354=>{var _0x5bfe97=_0x1c33a0,_0x517bb9=_0x3fdef4[_0x5bfe97(0x22e)];console[_0x5bfe97(0x1f0)](_0x5bfe97(0x2d5));var _0x531e77=_0x252354['userId'],_0x190700=Math[_0x5bfe97(0x22f)](new Date()[_0x5bfe97(0x257)]()/0x3e8);db[_0x5bfe97(0x233)]('SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20status=\x20'+STATUS_LIVE_CALL_ONGOING+_0x5bfe97(0x2b6)+_0x531e77,async function(_0x2b15cf,_0x35a9f0,_0x27d8e5){var _0x61512a=_0x5bfe97;if(_0x35a9f0[_0x61512a(0x20c)])console[_0x61512a(0x1f0)](_0x61512a(0x2d6),_0x35a9f0[0x0]['id']),_0x3fdef4['emit'](_0x61512a(0x2b9),{'liveCallId':_0x35a9f0[0x0]['id']});else{var _0x4fa056=await createToken(),_0x211283=_0x4fa056['channelName'],_0x1fc6a4=_0x4fa056[_0x61512a(0x295)],_0x30a99c=_0x61512a(0x2d7)+db['escape'](_0x531e77)+','+db['escape'](_0x190700)+','+db[_0x61512a(0x258)](_0x211283)+','+db[_0x61512a(0x258)](_0x1fc6a4)+'\x20)';db[_0x61512a(0x233)](_0x30a99c,function(_0xc3fdcc,_0x587ab0){var _0x2a5a11=_0x61512a;if(_0xc3fdcc)throw _0xc3fdcc;var _0x5843a9=_0x587ab0[_0x2a5a11(0x27b)];console[_0x2a5a11(0x1f0)](_0x5843a9),_0x3fdef4[_0x2a5a11(0x236)](_0x5843a9),_0x3fdef4[_0x2a5a11(0x237)](_0x2a5a11(0x2d8),{'liveCallId':_0x5843a9,'localCallId':_0x252354[_0x2a5a11(0x293)],'channelName':_0x211283,'token':_0x1fc6a4}),db[_0x2a5a11(0x233)](_0x2a5a11(0x264)+db[_0x2a5a11(0x258)](_0x531e77),function(_0x15351c,_0x560944,_0xb49099){var _0x2b97bb=_0x2a5a11;if(_0x560944){if(_0x560944[_0x2b97bb(0x20c)]){var _0xfb501c=_0x560944[0x0][_0x2b97bb(0x27d)],_0x1a589a=STORAGE_URL+_0x2b97bb(0x297)+_0xfb501c;_0xfb501c==null&&(_0x1a589a=null),db[_0x2b97bb(0x233)](_0x2b97bb(0x2ae)+_0x531e77,function(_0x147a15,_0x430cd5,_0x5793ef){var _0x1caee4=_0x2b97bb;_0x430cd5[_0x1caee4(0x20c)]&&_0x430cd5[_0x1caee4(0x235)](_0x1756c0=>{var _0x137798=_0x1caee4,_0x25fc24=_0x1756c0['device_token'];if(_0x25fc24){var _0x455342={'title':_0x517bb9+_0x137798(0x2af),'body':_0x517bb9+_0x137798(0x2d9),'notification_type':_0x137798(0x2b0),'liveCallId':_0x5843a9[_0x137798(0x284)](),'channelName':_0x211283,'token':_0x1fc6a4,'userImageUrl':_0x1a589a,'userId':_0x531e77[_0x137798(0x284)]()};sendPushNotification(_0x25fc24,_0x455342);}});});}}});});}});}),_0x3fdef4['on'](_0x1c33a0(0x2da),_0xcff804=>{var _0x5b5141=_0x1c33a0;console['log'](_0x5b5141(0x2db));var _0x2ca538=_0xcff804[_0x5b5141(0x22d)],_0x13b6dd={'userId':_0x2ca538};endLiveCallIfExist(_0x3fdef4,_0x13b6dd);}),_0x3fdef4['on']('leaveUserLiveCall',_0x58828c=>{var _0x506d62=_0x1c33a0;console[_0x506d62(0x1f0)]('leave\x20live\x20call');var _0x2d9257=_0x58828c['userId'],_0x48254a=_0x58828c[_0x506d62(0x2b3)];_0x3fdef4['to'](_0x48254a)[_0x506d62(0x237)](_0x506d62(0x2dc),{'username':_0x3fdef4[_0x506d62(0x22e)],'userId':_0x3fdef4[_0x506d62(0x22d)],'liveCallId':_0x48254a}),_0x3fdef4[_0x506d62(0x261)](_0x48254a);var _0x1cceac='delete\x20from\x20live_tv_viewer\x20\x20where\x20\x20live_call_id\x20='+db['escape'](_0x48254a)+_0x506d62(0x2dd)+db[_0x506d62(0x258)](_0x2d9257);db['query'](_0x1cceac,function(_0xec3f14,_0x4481c9,_0x53684a){});}),_0x3fdef4['on'](_0x1c33a0(0x2de),async _0x6e3956=>{var _0x438083=_0x1c33a0;console[_0x438083(0x1f0)](_0x438083(0x2df));var _0x3bfa85=_0x6e3956[_0x438083(0x22d)],_0x27940e=_0x6e3956[_0x438083(0x2b3)];_0x3fdef4[_0x438083(0x236)](_0x27940e),_0x3fdef4['to'](_0x27940e)['emit']('addUserLiveCall',{'username':_0x3fdef4[_0x438083(0x22e)],'userId':_0x3fdef4['userId'],'liveCallId':_0x27940e});var _0x2c15e1={'liveCallId':_0x27940e},_0x31af09=await getLiveBattleInfo(_0x2c15e1);_0x31af09[_0x438083(0x2e0)][_0x438083(0x20c)]>0x0&&_0x3fdef4[_0x438083(0x237)](_0x438083(0x2cf),{'liveCallId':_0x27940e,'battleInfo':_0x31af09});var _0x78f582=Math[_0x438083(0x22f)](new Date()[_0x438083(0x257)]()/0x3e8);db[_0x438083(0x233)]('SELECT\x20count(id)\x20as\x20total\x20FROM\x20live_call_viewer\x20where\x20\x20\x20live_call_id\x20='+db[_0x438083(0x258)](_0x27940e)+_0x438083(0x2b6)+db[_0x438083(0x258)](_0x3bfa85),function(_0x1c00f2,_0x4316bc,_0x4e2c02){var _0x20d90e=_0x438083;if(_0x4316bc[0x0][_0x20d90e(0x2e1)]==0x0){var _0x47b302=_0x20d90e(0x2e2)+db[_0x20d90e(0x258)](_0x3bfa85)+','+db['escape'](_0x27940e)+','+db[_0x20d90e(0x258)](_0x78f582)+'\x20)';db[_0x20d90e(0x233)](_0x47b302,function(_0x5db594,_0x15e669){if(_0x5db594)throw _0x5db594;});}});}),_0x3fdef4['on']('sendMessageLiveCall',_0xb78e9=>{var _0x126b84=_0x1c33a0;_0xb78e9[_0x126b84(0x22e)]=_0x3fdef4[_0x126b84(0x22e)],_0xb78e9['created_at']=Math[_0x126b84(0x22f)](new Date()[_0x126b84(0x257)]()/0x3e8),_0xb78e9[_0x126b84(0x244)]=_0xb78e9[_0x126b84(0x22d)];var _0x362d1c=_0xb78e9[_0x126b84(0x2b3)];_0x3fdef4['to'](_0x362d1c)[_0x126b84(0x237)](_0x126b84(0x2e3),_0xb78e9),_0x3fdef4['emit'](_0x126b84(0x2e4),{'current_status':0x1,'localMessageId':_0xb78e9['localMessageId'],'liveCallId':_0x362d1c,'created_at':_0xb78e9[_0x126b84(0x243)]});}),_0x3fdef4['on']('endLiveBattle',async _0x3df8e=>{var _0x1fdfde=_0x1c33a0;console[_0x1fdfde(0x1f0)](_0x1fdfde(0x2e5));var _0x450bc3=_0x3df8e[_0x1fdfde(0x2c4)],_0x27382c=Math[_0x1fdfde(0x22f)](new Date()[_0x1fdfde(0x257)]()/0x3e8),_0x3550a5=_0x1fdfde(0x2e6)+_0x450bc3,_0xb400a=await getDbData(_0x3550a5);if(_0xb400a[_0x1fdfde(0x20c)]==0x0)return console['log'](_0x1fdfde(0x2e7)),![];var _0x477c3a=_0xb400a[0x0],_0x450bc3=_0x477c3a['id'],_0x2afa3f=_0x477c3a[_0x1fdfde(0x2a4)],_0xf61a45=_0x27382c-_0x2afa3f,_0x277ac7=_0x477c3a['user_live_history_id'],_0x51a4cd=_0x1fdfde(0x2bc)+STATUS_LIVE_CALL_BATTLE_COMPLETED+_0x1fdfde(0x2e8)+db[_0x1fdfde(0x258)](_0x27382c)+_0x1fdfde(0x2e9)+db[_0x1fdfde(0x258)](_0xf61a45)+_0x1fdfde(0x2bd)+db[_0x1fdfde(0x258)](_0x450bc3);getDbData(_0x51a4cd),io['to'](_0x277ac7)['emit']('endLiveBattle',{'username':_0x3fdef4[_0x1fdfde(0x22e)],'userId':_0x3fdef4[_0x1fdfde(0x22d)],'liveCallId':_0x277ac7,'battleId':_0x450bc3});}),_0x3fdef4['on'](_0x1c33a0(0x2ea),async _0x9bdc90=>{var _0x4c4d17=_0x1c33a0;console['log']('send\x20gift\x20to\x20live\x20user\x20call');var _0x12e462=_0x3fdef4[_0x4c4d17(0x22d)],_0x5d8480=_0x9bdc90['userId'],_0x34e6bb=_0x9bdc90[_0x4c4d17(0x2b3)],_0x1c6c35=_0x9bdc90[_0x4c4d17(0x2c4)],_0xfadaae=_0x9bdc90[_0x4c4d17(0x2eb)],_0x94b93a=Math[_0x4c4d17(0x22f)](new Date()['getTime']()/0x3e8),_0x54b19d='SELECT\x20\x20*\x20from\x20gift\x20\x20where\x20id=\x20'+_0xfadaae,_0x53595a=await getDbData(_0x54b19d);if(_0x53595a[_0x4c4d17(0x20c)]==0x0)return console[_0x4c4d17(0x1f0)](_0x4c4d17(0x2ec)),![];var _0x28eb0c=_0x53595a[0x0],_0x2cdc12=_0x28eb0c[_0x4c4d17(0x2ed)],_0xfbea18=_0x28eb0c['is_paid'],_0x54b19d=_0x4c4d17(0x2ee)+_0x12e462,_0x13ed04=await getDbData(_0x54b19d),_0x222ed9=_0x13ed04[0x0],_0x16576d=_0x222ed9[_0x4c4d17(0x2ef)];_0x2cdc12>_0x16576d&&_0x3fdef4[_0x4c4d17(0x237)](_0x4c4d17(0x2f0),{'availableCoin':_0x16576d,'gitCoin':_0x2cdc12});var _0x54b19d=_0x4c4d17(0x2f1),_0x5c1bab=await getDbData(_0x54b19d),_0x65794b=_0x5c1bab[0x0],_0x3923e0=_0x65794b[_0x4c4d17(0x2ef)],_0xceab77=_0x65794b['commission_on_gift'],_0x905682=0x0;_0xceab77>0x0&&(_0x905682=_0x2cdc12/0x64*_0xceab77);var _0x42c863=_0x2cdc12-_0x905682,_0x54b19d;_0x1c6c35>0x0?_0x54b19d=_0x4c4d17(0x2f2)+db[_0x4c4d17(0x258)](_0x12e462)+','+db[_0x4c4d17(0x258)](_0x5d8480)+','+db[_0x4c4d17(0x258)](_0xfadaae)+','+db['escape'](_0x42c863)+','+db[_0x4c4d17(0x258)](_0x2cdc12)+','+db['escape'](0x1)+','+db[_0x4c4d17(0x258)](_0x34e6bb)+','+db[_0x4c4d17(0x258)](_0x1c6c35)+','+db[_0x4c4d17(0x258)](_0x94b93a)+'\x20)':_0x54b19d=_0x4c4d17(0x2f3)+db['escape'](_0x12e462)+','+db['escape'](_0x5d8480)+','+db[_0x4c4d17(0x258)](_0xfadaae)+','+db[_0x4c4d17(0x258)](_0x42c863)+','+db[_0x4c4d17(0x258)](_0x2cdc12)+','+db[_0x4c4d17(0x258)](0x1)+','+db['escape'](_0x34e6bb)+','+db[_0x4c4d17(0x258)](_0x94b93a)+'\x20)';var _0x4a3df7=await getDbData(_0x54b19d),_0x599414=_0x4a3df7[_0x4c4d17(0x27b)];if(_0xfbea18==0x1){if(_0x599414){var _0x342bdf=_0x16576d-_0x2cdc12,_0x54b19d=_0x4c4d17(0x2f4)+_0x342bdf+'\x20where\x20id\x20=\x20'+_0x12e462,_0x464abc=await getDbData(_0x54b19d);if(_0x464abc){var _0x1fd955=0x2,_0x27b388=0x2,_0x4f47ad=0x6,_0x30272d=0x3,_0x54b19d=_0x4c4d17(0x2f5)+db[_0x4c4d17(0x258)](_0x1fd955)+','+db[_0x4c4d17(0x258)](_0x12e462)+','+db[_0x4c4d17(0x258)](_0x27b388)+','+db[_0x4c4d17(0x258)](_0x4f47ad)+','+db[_0x4c4d17(0x258)](_0x30272d)+','+db['escape'](_0x2cdc12)+','+db[_0x4c4d17(0x258)](_0x599414)+','+db[_0x4c4d17(0x258)](_0x94b93a)+'\x20)',_0x4a3df7=await getDbData(_0x54b19d),_0x54b19d=_0x4c4d17(0x2f6)+_0x5d8480,_0x478612=await getDbData(_0x54b19d),_0x2b19f2=_0x478612[0x0],_0x16576d=_0x2b19f2[_0x4c4d17(0x2ef)],_0x342bdf=_0x16576d+_0x42c863,_0x54b19d='update\x20user\x20set\x20available_coin='+_0x342bdf+_0x4c4d17(0x2bd)+_0x5d8480,_0x464abc=await getDbData(_0x54b19d),_0x1fd955=0x2,_0x27b388=0x1,_0x4f47ad=0x6,_0x30272d=0x3,_0x54b19d=_0x4c4d17(0x2f5)+db['escape'](_0x1fd955)+','+db[_0x4c4d17(0x258)](_0x5d8480)+','+db[_0x4c4d17(0x258)](_0x27b388)+','+db['escape'](_0x4f47ad)+','+db[_0x4c4d17(0x258)](_0x30272d)+','+db['escape'](_0x42c863)+','+db['escape'](_0x599414)+','+db['escape'](_0x94b93a)+'\x20)',_0x4a3df7=await getDbData(_0x54b19d);if(_0x905682>0x0)var _0x523992=_0x3923e0+_0x905682,_0x54b19d='update\x20setting\x20set\x20available_coin='+_0x523992+'\x20where\x20id\x20=\x201',_0x4a7e5d=await getDbData(_0x54b19d),_0x1bd345=0x1,_0x1fd955=0x2,_0x27b388=0x1,_0x4f47ad=0xd,_0x30272d=0x3,_0x54b19d=_0x4c4d17(0x2f5)+db['escape'](_0x1fd955)+','+db[_0x4c4d17(0x258)](_0x1bd345)+','+db[_0x4c4d17(0x258)](_0x27b388)+','+db['escape'](_0x4f47ad)+','+db[_0x4c4d17(0x258)](_0x30272d)+','+db['escape'](_0x905682)+','+db['escape'](_0x599414)+','+db['escape'](_0x94b93a)+'\x20)',_0x4a3df7=await getDbData(_0x54b19d);}}}var _0x3d890c={'liveCallId':_0x34e6bb,'battleId':_0x1c6c35},_0xc25d42=await getLiveBattleInfo(_0x3d890c),_0x34a90c=STORAGE_URL+_0x4c4d17(0x2f7)+_0x28eb0c['image'],_0x2a8b25=STORAGE_URL+_0x4c4d17(0x297)+_0x222ed9[_0x4c4d17(0x27d)];_0x34a90c==null&&(_0x2a8b25=null),_0x9bdc90['giftUrl']=_0x34a90c,_0x9bdc90[_0x4c4d17(0x2f8)]=_0x28eb0c[_0x4c4d17(0x2f8)],_0x9bdc90[_0x4c4d17(0x2ed)]=_0x28eb0c[_0x4c4d17(0x2ed)],_0x9bdc90[_0x4c4d17(0x2f9)]=_0xc25d42,_0x9bdc90['senderId']=_0x12e462,_0x9bdc90['senderName']=_0x222ed9[_0x4c4d17(0x22e)],_0x9bdc90[_0x4c4d17(0x2fa)]=_0x2a8b25,io['to'](_0x34e6bb)[_0x4c4d17(0x237)](_0x4c4d17(0x2fb),_0x9bdc90);}),_0x3fdef4['on']('addUserLiveTv',_0x34d541=>{var _0x34b6a5=_0x1c33a0;console[_0x34b6a5(0x1f0)]('user\x20added\x20in\x20live\x20tv');var _0x203235=_0x34d541[_0x34b6a5(0x22d)],_0x3f2b8f=_0x34d541['liveTvId'];_0x3fdef4['join'](_0x3f2b8f),_0x3fdef4['to'](_0x3f2b8f)[_0x34b6a5(0x237)](_0x34b6a5(0x2fc),{'username':_0x3fdef4[_0x34b6a5(0x22e)],'userId':_0x3fdef4[_0x34b6a5(0x22d)],'liveTvId':_0x3f2b8f});const _0xc08b45=_0x3f2b8f[_0x34b6a5(0x2fd)]('_');let _0x2982bc=_0xc08b45[0x1];var _0x1afc98=Math[_0x34b6a5(0x22f)](new Date()[_0x34b6a5(0x257)]()/0x3e8);db[_0x34b6a5(0x233)](_0x34b6a5(0x2fe)+db[_0x34b6a5(0x258)](_0x2982bc)+_0x34b6a5(0x2b6)+db[_0x34b6a5(0x258)](_0x203235),function(_0x2d79f8,_0x260db8,_0x5633c9){var _0x419c13=_0x34b6a5;if(_0x260db8[0x0]['total']==0x0){var _0x2b1c05='INSERT\x20INTO\x20live_tv_viewer\x20(user_id,\x20live_tv_id,created_at)\x20VALUES\x20('+db['escape'](_0x203235)+','+db[_0x419c13(0x258)](_0x2982bc)+','+db[_0x419c13(0x258)](_0x1afc98)+'\x20)';db[_0x419c13(0x233)](_0x2b1c05,function(_0x250227,_0x104635){if(_0x250227)throw _0x250227;});}});}),_0x3fdef4['on'](_0x1c33a0(0x2ff),_0x2bb6a9=>{var _0x1c91f3=_0x1c33a0;console[_0x1c91f3(0x1f0)](_0x1c91f3(0x300));var _0x3d822c=_0x2bb6a9[_0x1c91f3(0x22d)],_0x122495=_0x2bb6a9[_0x1c91f3(0x301)];_0x3fdef4['to'](_0x122495)[_0x1c91f3(0x237)](_0x1c91f3(0x2ff),{'username':_0x3fdef4[_0x1c91f3(0x22e)],'userId':_0x3fdef4['userId'],'liveTvId':_0x122495}),_0x3fdef4[_0x1c91f3(0x261)](_0x122495);}),_0x3fdef4['on'](_0x1c33a0(0x302),_0x17dc13=>{var _0x86cad6=_0x1c33a0;_0x17dc13['username']=_0x3fdef4[_0x86cad6(0x22e)],_0x17dc13['created_at']=Math[_0x86cad6(0x22f)](new Date()[_0x86cad6(0x257)]()/0x3e8),_0x17dc13[_0x86cad6(0x244)]=_0x17dc13[_0x86cad6(0x22d)];var _0x4c0901=_0x17dc13[_0x86cad6(0x301)];_0x3fdef4['to'](_0x4c0901)[_0x86cad6(0x237)](_0x86cad6(0x302),_0x17dc13),_0x3fdef4[_0x86cad6(0x237)](_0x86cad6(0x303),{'current_status':0x1,'localMessageId':_0x17dc13['localMessageId'],'liveTvId':_0x4c0901,'created_at':_0x17dc13[_0x86cad6(0x243)]});}),_0x3fdef4['on'](_0x1c33a0(0x304),_0x6b3aee=>{var _0x4c8a04=_0x1c33a0;console['log'](_0x4c8a04(0x28f));const _0x19735e='eUzWru_LqrDO28TPywKTj5:APA91bFKpKN6qy6q3IXgO8Mkxy7bf22CrUO7mqyddT_MwKXLw4YHkaGrxkU03e1suVMwSGlV4cn9ek8ziM7Y1Rkv-lz3x5ZymzbLg6FsbgAuSRvPOJGsnh9TEKWSVTQ-ZY8pOVqSHAl4',_0xabee4b={'data':{'score':_0x4c8a04(0x305),'time':_0x4c8a04(0x306)},'token':_0x19735e};admin[_0x4c8a04(0x307)]()['send'](_0xabee4b)[_0x4c8a04(0x308)](_0x6f4d8f=>{var _0x18b3b0=_0x4c8a04;console['log'](_0x18b3b0(0x309),_0x6f4d8f);})['catch'](_0x36f197=>{var _0x2369e5=_0x4c8a04;console['log'](_0x2369e5(0x30a),_0x36f197);});});});function getMessageBody(_0x1a1df8){var _0x57f576=soi_0x4c927d,_0x3b54d6={},_0x522249='';_0x3b54d6[_0x57f576(0x283)]='',_0x3b54d6['image']='';var _0x201b8f=doDecrypt(_0x1a1df8['message']);console[_0x57f576(0x1f0)](_0x201b8f);var _0x4d62eb=_0x201b8f[_0x57f576(0x27a)];if(_0x4d62eb==0x1)_0x3b54d6[_0x57f576(0x283)]=doDecrypt(_0x201b8f[_0x57f576(0x30b)]);else{if(_0x4d62eb==0x2)_0x3b54d6['messageString']=_0x57f576(0x30c);else{if(_0x4d62eb==0x3)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x30d);else{if(_0x4d62eb==0x4)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x30e);else{if(_0x4d62eb==0x5)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x30f);else{if(_0x4d62eb==0x6)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x310);else{if(_0x4d62eb==0x7)_0x3b54d6['messageString']=_0x57f576(0x311);else{if(_0x4d62eb==0x8)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x312);else{if(_0x4d62eb==0xa)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x313);else{if(_0x4d62eb==0xb)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x314);else{if(_0x4d62eb==0xc)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x315);else{if(_0x4d62eb==0xd)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x316);else{if(_0x4d62eb==0xe)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x317);else{if(_0x4d62eb==0xf)_0x3b54d6[_0x57f576(0x283)]='Sent\x20a\x20group';else{if(_0x4d62eb==0x10)_0x3b54d6[_0x57f576(0x283)]='Sent\x20a\x20file';else{if(_0x4d62eb==0x14)_0x3b54d6[_0x57f576(0x283)]='Reacted\x20on\x20your\x20message';else{if(_0x4d62eb==0x64)_0x3b54d6[_0x57f576(0x283)]=_0x57f576(0x318);else _0x4d62eb==0xc8?_0x3b54d6['messageString']=_0x57f576(0x319):_0x3b54d6[_0x57f576(0x283)]='Sent\x20a\x20message';}}}}}}}}}}}}}}}}return _0x3b54d6;}function sendPushNotification(_0x2935f3,_0x5339e1){var _0x2d5b76=soi_0x4c927d;_0x5339e1[_0x2d5b76(0x31a)]==null&&(_0x5339e1[_0x2d5b76(0x31a)]='');_0x5339e1[_0x2d5b76(0x31b)]==null&&(_0x5339e1[_0x2d5b76(0x31b)]='');_0x5339e1[_0x2d5b76(0x226)]=_0x2d5b76(0x31c),_0x5339e1[_0x2d5b76(0x31d)]=_0x2d5b76(0x31e),_0x5339e1[_0x2d5b76(0x31f)]=_0x2d5b76(0x320),console[_0x2d5b76(0x1f0)](_0x5339e1[_0x2d5b76(0x29d)]);var _0x11c1d9=_0x5339e1[_0x2d5b76(0x29d)];_0x11c1d9=_0x11c1d9['toString']();_0x11c1d9['length']>0x64&&(_0x11c1d9=_0x11c1d9['substring'](0x0,0x64));_0x5339e1['body']=_0x11c1d9;var _0x42c2ce={'notification':{'title':_0x5339e1['title'],'body':_0x11c1d9},'data':_0x5339e1,'token':_0x2935f3};console['log'](_0x42c2ce),admin[_0x2d5b76(0x307)]()[_0x2d5b76(0x321)](_0x42c2ce)['then'](_0xcbe3db=>{var _0x47f781=_0x2d5b76;console['log'](_0x47f781(0x309),_0xcbe3db);})[_0x2d5b76(0x322)](_0x52e551=>{var _0x2aed07=_0x2d5b76;console['log'](_0x2aed07(0x30a),_0x52e551);});}function sendIosVoipPushNotification(_0x3dd185,_0x8c7cd6){var _0x22760a=soi_0x4c927d,_0x166e48={'token':{'key':config[_0x22760a(0x21d)][_0x22760a(0x1e9)],'keyId':config[_0x22760a(0x21d)][_0x22760a(0x323)],'teamId':config[_0x22760a(0x21d)]['teamId']},'production':![]},_0x578473=new apn['Provider'](_0x166e48),_0x285ef0=new apn[(_0x22760a(0x220))]();_0x285ef0[_0x22760a(0x324)]=Math[_0x22760a(0x223)](Date[_0x22760a(0x224)]()/0x3e8)+0x3c,_0x285ef0[_0x22760a(0x225)]=0x1,_0x285ef0[_0x22760a(0x226)]=_0x22760a(0x325),_0x285ef0[_0x22760a(0x227)]=_0x22760a(0x228),_0x285ef0[_0x22760a(0x326)]=_0x8c7cd6,_0x285ef0[_0x22760a(0x229)]=config['voipNotification']['bundleId']+'.voip',_0x578473['send'](_0x285ef0,_0x3dd185)[_0x22760a(0x308)]((_0x13c996,_0x1bfda6)=>{var _0x23d92c=_0x22760a;console['log'](_0x1bfda6),_0x13c996?console['log'](JSON[_0x23d92c(0x22b)](_0x13c996)):console[_0x23d92c(0x1f0)](JSON[_0x23d92c(0x22b)](_0x1bfda6));});}async function createToken(){var _0x4cefd6=soi_0x4c927d;let _0x53cabc=_0x4cefd6(0x2f1);var _0x21d6c8=await getDbData(_0x53cabc),_0x53d0a6=uuidv4();const _0x5c6dcf=_0x21d6c8[0x0][_0x4cefd6(0x327)],_0x3a55ac=_0x21d6c8[0x0][_0x4cefd6(0x328)],_0x4303ea=0x0,_0x160cef='0',_0x57db37=RtcRole[_0x4cefd6(0x329)],_0x1960cb=0xe10,_0x3239c3=Math[_0x4cefd6(0x223)](Date[_0x4cefd6(0x224)]()/0x3e8),_0x1c03eb=_0x3239c3+_0x1960cb,_0x2af9e4=RtcTokenBuilder[_0x4cefd6(0x32a)](_0x5c6dcf,_0x3a55ac,_0x53d0a6,_0x4303ea,_0x57db37,_0x1c03eb);return{'channelName':_0x53d0a6,'token':_0x2af9e4};}function doEncrypt(_0x360b40){var _0x1babb2=soi_0x4c927d;typeof _0x360b40==_0x1babb2(0x32b)&&(_0x360b40=JSON['stringify'](_0x360b40));var _0x3439f1=config[_0x1babb2(0x32c)],_0x1e87b5=crypto[_0x1babb2(0x32d)][_0x1babb2(0x32e)](_0x360b40,_0x3439f1)[_0x1babb2(0x284)]();return _0x1e87b5;}function doDecrypt(_0x53564d){var _0x3befb2=soi_0x4c927d,_0x51adaa=config[_0x3befb2(0x32c)],_0x1f83d9=crypto[_0x3befb2(0x32d)]['decrypt'](_0x53564d,_0x51adaa)[_0x3befb2(0x284)](crypto['enc'][_0x3befb2(0x32f)]);return isJsonString(_0x1f83d9)&&(_0x1f83d9=JSON[_0x3befb2(0x330)](_0x1f83d9)),_0x1f83d9;}function isJsonString(_0x236a7e){try{JSON['parse'](_0x236a7e);}catch(_0xb1bc81){return![];}return!![];}function getDbData(_0x57c924){return new Promise((_0x3c838a,_0x129495)=>{var _0x452f85=soi_0x4442;db[_0x452f85(0x233)](_0x57c924,function(_0x4eb71e,_0x408e58,_0x2f017d){if(_0x4eb71e)return _0x129495(_0x4eb71e);return _0x3c838a(_0x408e58);});});}async function endLiveCallIfExist(_0x35c2be,_0x5a8539){var _0x11010e=soi_0x4c927d;userId=_0x5a8539[_0x11010e(0x22d)];var _0x531c86=Math[_0x11010e(0x22f)](new Date()[_0x11010e(0x257)]()/0x3e8),_0x3c2378='SELECT\x20\x20*\x20from\x20user_live_history\x20where\x20status=\x20'+STATUS_LIVE_CALL_ONGOING+_0x11010e(0x2b6)+userId,_0x5759c2=await getDbData(_0x3c2378);if(_0x5759c2['length']){var _0x847384=_0x5759c2[0x0]['id'],_0x6f91bd=_0x5759c2[0x0]['start_time'],_0x41bde0=_0x531c86-_0x6f91bd,_0x5d0e53=_0x11010e(0x331)+STATUS_LIVE_CALL_COMPLETED+',\x20end_time\x20=\x20'+db[_0x11010e(0x258)](_0x531c86)+'\x20,\x20total_time\x20=\x20'+db[_0x11010e(0x258)](_0x41bde0)+_0x11010e(0x2bd)+db['escape'](_0x847384);getDbData(_0x5d0e53);var _0x3c2378=_0x11010e(0x332)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x11010e(0x333)+userId,_0x7b52f8=await getDbData(_0x3c2378);_0x7b52f8[_0x11010e(0x20c)]&&_0x7b52f8[_0x11010e(0x235)](_0x40a3c1=>{var _0x37e8e8=_0x11010e,_0x44fcd8=_0x40a3c1['id'],_0xbe1503=_0x40a3c1[_0x37e8e8(0x2a4)],_0x1bbce1=_0x531c86-_0xbe1503,_0x3e9492=_0x37e8e8(0x2bc)+STATUS_LIVE_CALL_BATTLE_COMPLETED+',\x20end_time\x20=\x20'+db[_0x37e8e8(0x258)](_0x531c86)+'\x20,\x20total_time\x20=\x20'+db[_0x37e8e8(0x258)](_0x1bbce1)+_0x37e8e8(0x2bd)+db['escape'](_0x44fcd8);getDbData(_0x3e9492);}),_0x35c2be['to'](_0x847384)[_0x11010e(0x237)](_0x11010e(0x2da),{'liveCallId':_0x847384,'userId':_0x35c2be[_0x11010e(0x22d)],'username':_0x35c2be[_0x11010e(0x22e)]}),io['in'](_0x847384)[_0x11010e(0x334)](_0x847384);}var _0x3c2378=_0x11010e(0x332)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x11010e(0x2b7)+userId,_0x7b52f8=await getDbData(_0x3c2378);_0x7b52f8[_0x11010e(0x20c)]&&_0x7b52f8[_0x11010e(0x235)](async _0x5e082c=>{var _0x2f5d66=_0x11010e,_0x1eeb92=_0x5e082c['id'],_0x4832d5=_0x5e082c[_0x2f5d66(0x2ba)],_0x22150f=_0x5e082c[_0x2f5d66(0x2a4)],_0x142ddd=_0x531c86-_0x22150f,_0x2f1008='update\x20user_live_battle\x20set\x20status='+STATUS_LIVE_CALL_BATTLE_COMPLETED+',\x20end_time\x20=\x20'+db[_0x2f5d66(0x258)](_0x531c86)+_0x2f5d66(0x2e9)+db[_0x2f5d66(0x258)](_0x142ddd)+_0x2f5d66(0x2bd)+db[_0x2f5d66(0x258)](_0x1eeb92);getDbData(_0x2f1008);var _0x1f5812={'liveCallId':_0x4832d5,'battleId':_0x1eeb92},_0x1d151b=await getLiveBattleInfo(_0x1f5812);io['to'](_0x4832d5)[_0x2f5d66(0x237)](_0x2f5d66(0x2cf),{'liveCallId':_0x4832d5,'battleId':_0x1eeb92,'battleInfo':_0x1d151b});});}function soi_0x1b47(){var _0x2bfb74=['\x20and\x20chat_message_user.status=','delete_time','update\x20chat_message\x20set\x20status=\x27','\x27\x20where\x20id\x20=','update\x20chat_message_user\x20set\x20status=\x27','\x27\x20where\x20chat_message_id\x20=','socket_id','sendMessage','type','replied_on_message','created_at','created_by','is_encrypted','chat_version','sockets','sender_socket_id','updateMessageCurrentStatusUser','local_message_id','room_id','\x27,\x20is_user_notify=\x27','chat_message_user_id','SELECT\x20chat_message_user.id\x20as\x20chat_message_user_id,\x20chat_message_user.user_id,chat_message_user.chat_message_id,chat_message_user.status,\x20chat_message.local_message_id,\x20chat_message.room_id\x20FROM\x20chat_message_user\x20left\x20join\x20chat_message\x20on\x20chat_message.id\x20=\x20chat_message_user.chat_message_id\x20where\x20chat_message.created_by\x20=\x20','\x20and\x20chat_message_user.is_user_notify=','\x20and\x20chat_message.status\x20<>','push','status','chat_message_id','user_id','update\x20chat_message_user\x20set\x20is_user_notify=\x27','\x27\x20where\x20id\x20IN(','getTime','escape','SELECT\x20id,username,socket_id\x20FROM\x20user\x20where\x20id\x20IN(','\x20and\x20room_id\x20=','\x20and\x20status\x20=10','INSERT\x20INTO\x20chat_room_user\x20(room_id,\x20user_id,is_admin,created_at,created_by)\x20VALUES\x20(','leftRoom','left\x20room','\x27\x20where\x20user_id\x20=\x20','\x20and\x20room_id\x20=\x20','leave','removeUserFromRoom','room','SELECT\x20*\x20FROM\x20user\x20where\x20\x20\x20id\x20=','update\x20chat_room_user\x20set\x20status=\x27','makeRoomAdmin','update\x20chat_room_user\x20set\x20is_admin=1\x20where\x20user_id\x20=\x20','update\x20chat_room_user\x20set\x20is_admin=0\x20where\x20user_id\x20=\x20','removeRoomAdmin','updateChatAccessGroup','chatAccessGroup','update\x20chat_room\x20set\x20chat_access_group=','\x20where\x20\x20id\x20=\x20','disconnect','update\x20user\x20set\x20socket_id=NULL,chat_last_time_online=\x27','delete\x20from\x20live_tv_viewer\x20\x20where\x20user_id\x20=\x20','delete\x20from\x20live_call_viewer\x20\x20where\x20user_id\x20=\x20','removeAllListeners','user\x20disconnected','user\x20disconnected\x20errrRRR','SELECT\x20\x20chat_room.type,chat_room_user.id,chat_room_user.status,chat_room_user.user_id,user.device_token,user.socket_id\x20FROM\x20chat_room_user\x20left\x20join\x20user\x20on\x20chat_room_user.user_id\x20=\x20user.id\x20left\x20join\x20chat_room\x20on\x20chat_room_user.room_id=chat_room.id\x20\x20where\x20chat_room_user.room_id\x20=','\x20and\x20\x20user_id\x20=','deleteAfter','INSERT\x20INTO\x20chat_message\x20(local_message_id,room_id,\x20type,\x20message,\x20replied_on_message,\x20is_encrypted,\x20chat_version,\x20created_by,\x20created_at,delete_time)\x20VALUES\x20(','localMessageId','messageType','insertId','updateMessageCurrentStatus','image','update\x20chat_room_user\x20set\x20status=\x2710\x27\x20where\x20id\x20=','reciever\x20socket\x20connected','reciever\x20socket\x20not\x20\x20connected\x20and\x20send\x20push\x20notification','100','200','messageString','toString','INSERT\x20INTO\x20chat_message_user\x20(chat_message_id,\x20user_id,\x20status,is_user_notify)\x20VALUES\x20?','readMessage','read\x20message','SELECT\x20*\x20FROM\x20chat_message\x20where\x20\x20id\x20=','seeen\x20message\x20sento\x20to','\x27\x20where\x20chat_message_id\x20=\x20','deleteMessage','delete\x20message','deleteScope','\x20and\x20user_id\x20=\x20','typing','callCreate','recieverId','callType','localCallId','channelName','token','INSERT\x20INTO\x20call_detail\x20(uuid,local_call_id,call_type,\x20caller_id,\x20receiver_id,\x20start_time,\x20channel_name)\x20VALUES\x20(','/user/','notification_type','103','device_type','device_token','title','body','New\x20Call','device_token_voip_ios','callCreateConfirm','performActionOnCall','SELECT\x20*\x20FROM\x20call_detail\x20where\x20\x20\x20uuid\x20=','caller_id','start_time','channel_name','call_type','update\x20call_detail\x20set\x20status=','\x20where\x20uuid\x20=\x20','SELECT\x20id,username,socket_id,device_type,device_token,device_token_voip_ios\x20FROM\x20user\x20where\x20id\x20=','callStatusUpdate','104','goLive','go\x20live\x20room\x20created\x20request','SELECT\x20\x20user.id,user.username,user.socket_id,user.device_token\x20FROM\x20follower\x20left\x20join\x20user\x20on\x20follower.follower_id\x20=\x20user.id\x20where\x20follower.user_id\x20=','\x20is\x20live','101','inviteUserInLiveBattle','Invite\x20for\x20live\x20battle','liveCallId','totalAllowedTime','SELECT\x20*\x20FROM\x20user\x20where\x20\x20id\x20=','\x20and\x20user_id\x20=','\x20and\x20host_user_id\x20=','alreadyLiveAnotherCall\x20battle','alreadyLiveAnotherCall','user_live_history_id','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20user_live_history_id=\x20','update\x20user_live_battle\x20set\x20status=','\x20where\x20id\x20=\x20','alreadyInviteUserInLiveBattleSent\x20and\x20cancelled\x20the\x20old\x20one\x20request','SELECT\x20*\x20FROM\x20user_live_history\x20where\x20\x20\x20id\x20=','INSERT\x20INTO\x20user_live_battle\x20(user_live_history_id,super_host_user_id,host_user_id,\x20total_allowed_time,created_at,status)\x20VALUES\x20(','inviteUserInLiveBattleConfirm','newliveBattleInvitation','replyLiveBattleInvitation','battleId','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20id=\x20','no\x20resultsLiveCall\x20Battle\x20','reply\x20battle\x20:\x20alreadyStatusUpdatedLiveBattleInvitation\x20','alreadyStatusUpdatedLiveBattleInvitation','reply\x20battle\x20:\x20call\x20status\x20has\x20been\x20closed\x20now\x20','SELECT\x20\x20user.id,user.username,user.socket_id\x20from\x20user\x20where\x20id=\x20','liveBattleInvitationUpated','rejected\x20notitifcation',',start_time=','reply\x20battle\x20:\x20liveBattleInvitationUpated','liveBattleHostUpdated','SELECT\x20\x20*\x20from\x20user\x20where\x20id=\x20','\x20is\x20live\x20in\x20battle','\x20is\x20live\x20now\x20in\x20battle','111','goLive_OLD','go\x20live\x20room\x20created','already\x20live\x20call\x20id\x20','INSERT\x20INTO\x20user_live_history\x20(user_id,\x20start_time,channel_name,token)\x20VALUES\x20(','goLiveConfirm','\x20is\x20live\x20now','endLiveCall','end\x20\x20live\x20call','leaveUserLiveCall','\x20and\x20\x20user_id\x20=\x20','addUserLiveCall','user\x20added\x20in\x20live\x20call','liveBattleHosts','total','INSERT\x20INTO\x20live_call_viewer\x20(user_id,\x20live_call_id,created_at)\x20VALUES\x20(','sendMessageLiveCall','updateMessageStatusLiveCall','end\x20live\x20battle','SELECT\x20\x20*\x20from\x20user_live_battle\x20\x20where\x20id=\x20','No\x20battle\x20found',',\x20end_time\x20=\x20','\x20,\x20total_time\x20=\x20','sendGiftLiveCall','giftId','No\x20gift\x20record\x20available','coin','SELECT\x20\x20user.id,user.username,user.socket_id,available_coin,\x20user.image\x20from\x20user\x20where\x20id=\x20','available_coin','notEnoughBalanceLiveCallGift','SELECT\x20*\x20FROM\x20setting','INSERT\x20INTO\x20gift_history\x20(sender_id,reciever_id,gift_id,coin,coin_actual,\x20send_on_type,\x20live_call_id,battle_id,created_at)\x20VALUES\x20(','INSERT\x20INTO\x20gift_history\x20(sender_id,reciever_id,gift_id,coin,coin_actual,send_on_type,\x20live_call_id,created_at)\x20VALUES\x20(','update\x20user\x20set\x20available_coin=','INSERT\x20INTO\x20payment\x20(type,\x20user_id,\x20transaction_type,\x20payment_type,\x20payment_mode,\x20coin,\x20gift_history_id,created_at)\x20VALUES\x20(','SELECT\x20\x20user.id,user.username,user.socket_id,available_coin\x20from\x20user\x20where\x20id=\x20','/gift/','name','battleInfo','senderImageUrl','newGiftReceivedliveCall','addUserLiveTv','split','SELECT\x20count(id)\x20as\x20total\x20FROM\x20live_tv_viewer\x20where\x20\x20\x20live_tv_id\x20=','leaveUserLiveTv','leave\x20live\x20Tv','liveTvId','sendMessageLiveTv','updateMessageStatusLiveTv','sendNotificationTest','8520','2:43','messaging','then','Successfully\x20sent\x20message:','Error\x20sending\x20message:','text','Sent\x20an\x20image','Sent\x20a\x20video','Sent\x20and\x20audio','Sent\x20a\x20gif\x20file','Sent\x20a\x20stiker','Shared\x20the\x20contact','Shared\x20the\x20location','forword\x20the\x20message','Sent\x20a\x20\x20post','Sent\x20a\x20story','Sent\x20a\x20drawing','Sent\x20a\x20profile','Group\x20action','Send\x20a\x20gift','userImageUrl','userImage','default','content_available','true','priority','high','send','catch','keyId','expiry','ping.aiff','payload','agora_api_key','agora_app_certificate','PUBLISHER','buildTokenWithUid','object','encryptionKey','AES','encrypt','Utf8','parse','update\x20user_live_history\x20set\x20status=','SELECT\x20\x20*\x20from\x20user_live_battle\x20where\x20status=\x20','\x20and\x20super_host_user_id\x20=','socketsLeave','SELECT\x20\x20user_live_battle.id\x20,\x20user_live_battle.super_host_user_id\x20,\x20user_live_battle.host_user_id,start_time,end_time,total_time,total_allowed_time\x20from\x20user_live_battle\x20\x20where\x20user_live_battle.status=\x20','\x20and\x20user_live_battle.user_live_history_id\x20=','totalOngoingTime','timeToEnd','total_allowed_time','SELECT\x20user.id,user.username,\x20user.image\x20from\x20user\x20where\x20user.id\x20=','super_host_user_id','total_coin','host_user_id','SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20=','\x20and\x20gift_history.battle_id\x20=','battleDetail','SELECT\x20\x20user_live_battle.id\x20,\x20user_live_battle.super_host_user_id\x20,\x20user_live_battle.host_user_id,start_time,end_time,total_time,total_allowed_time,status\x20from\x20user_live_battle\x20\x20where\x20\x20user_live_battle.id\x20=','total_gift','listen','port','listening\x20on\x20*:','660815ruizGF','250364JnLcSS','12KelVAN','20KaUtRe','940570jsmHrc','4768110uyvKbG','9494345sDvNuD','40oTaKAx','720513PSptbR','3822510htuAPo','http','createServer','sslCertificatePath','isSsl','readFileSync','key','cert','crypto-js','apn','uuid','storageUrl','hostname','log','DESKTOP-MRLV3Q3','createConnection','host','user','dev','database','live','./serviceAccountKey.json','initializeApp','pushNotification','databaseURL','warning','warn','connect','user_p_id','site_url','address','?purchase_code=','&site_url=','&source_type=chat&ip=','aHR0cHM6Ly9md2R0ZWNobm9sb2d5LmNvL2xpY2VuY2VfY2hlY2tlci9hcGkvd2ViL3YxL2xpY2VuY2Vz','ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=','_utf8_encode','charCodeAt','_keyStr','charAt','replace','length','indexOf','fromCharCode','_utf8_decode','decode','get','statusCode','end','NOTUP','close','Error:','message','error','sendFile','/index.html','/voiptest','79f2dd9dc247c30e1ab488bf352eb7c88eee0d519d1347fa99453e8ed2d5dcfd','voipNotification','teamId','Provider','Notification','baljit','sdfsjhfjsahfjshfjsd','floor','now','badge','sound','alert','New\x20call','topic','bundleId','stringify','login','userId','username','round','\x27,chat_last_time_online=\x27','\x27,is_chat_user_online=\x27','\x27\x20\x20where\x20id\x20=\x20','query','SELECT\x20*\x20FROM\x20chat_room_user\x20where\x20user_id\x20=','forEach','join','emit','userOnline'];soi_0x1b47=function(){return _0x2bfb74;};return soi_0x1b47();}async function getLiveBattleInfo(_0xdcaee6){var _0x17702e=soi_0x4c927d,_0x43e36d=_0xdcaee6['liveCallId'],_0x452ef8={},_0x5351e5={},_0x3efde6=[],_0x58fc01=_0x17702e(0x335)+STATUS_LIVE_CALL_BATTLE_ONGOING+_0x17702e(0x336)+_0x43e36d,_0x5e328d=await getDbData(_0x58fc01);if(_0x5e328d[_0x17702e(0x20c)]){var _0x36a863=_0x5e328d[0x0];_0x5351e5=_0x36a863;let _0x1c19d1=Math[_0x17702e(0x22f)](new Date()[_0x17702e(0x257)]()/0x3e8);var _0x20d109=_0x1c19d1-_0x5351e5[_0x17702e(0x2a4)];_0x5351e5[_0x17702e(0x337)]=_0x20d109,_0x5351e5[_0x17702e(0x338)]=_0x5351e5[_0x17702e(0x339)]-_0x20d109;var _0x58fc01=_0x17702e(0x33a)+_0x36a863['super_host_user_id'],_0x19dc72=await getDbData(_0x58fc01);if(_0x19dc72['length']){var _0x17e350=_0x19dc72[0x0],_0x58fc01='SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20='+_0x36a863[_0x17702e(0x33b)]+'\x20and\x20gift_history.battle_id\x20='+_0x36a863['id'],_0x8d5d8c=await getDbData(_0x58fc01),_0x14f48d=_0x8d5d8c[0x0],_0x3face9=STORAGE_URL+_0x17702e(0x297)+_0x17e350[_0x17702e(0x27d)];_0x17e350[_0x17702e(0x27d)]==null&&(_0x3face9=null);var _0x44c62f={'userId':_0x17e350['id'],'username':_0x17e350['username'],'userImageUrl':_0x3face9,'liveCallId':_0x43e36d,'battleId':_0x36a863['id'],'isSuperHost':0x1,'totalCoin':_0x14f48d[_0x17702e(0x33c)],'totalGift':_0x14f48d['total_gift']};_0x3efde6[_0x17702e(0x251)](_0x44c62f);}var _0x58fc01='SELECT\x20user.id,user.username,user.image\x20from\x20user\x20where\x20user.id\x20='+_0x36a863[_0x17702e(0x33d)],_0x5a543d=await getDbData(_0x58fc01);if(_0x5a543d[_0x17702e(0x20c)]){var _0x58fc01=_0x17702e(0x33e)+_0x36a863[_0x17702e(0x33d)]+_0x17702e(0x33f)+_0x36a863['id'],_0x8d5d8c=await getDbData(_0x58fc01),_0x14f48d=_0x8d5d8c[0x0],_0x2e3f9e=_0x5a543d[0x0],_0x3face9=STORAGE_URL+_0x17702e(0x297)+_0x2e3f9e[_0x17702e(0x27d)];_0x2e3f9e[_0x17702e(0x27d)]==null&&(_0x3face9=null);var _0x44c62f={'userId':_0x2e3f9e['id'],'username':_0x2e3f9e[_0x17702e(0x22e)],'userImageUrl':_0x3face9,'liveCallId':_0x43e36d,'battleId':_0x36a863['id'],'isSuperHost':0x0,'totalCoin':_0x14f48d[_0x17702e(0x33c)],'totalGift':_0x14f48d['total_gift']};_0x3efde6[_0x17702e(0x251)](_0x44c62f);}}return _0x452ef8[_0x17702e(0x340)]=_0x5351e5,_0x452ef8[_0x17702e(0x2e0)]=_0x3efde6,_0x452ef8;}async function getBattleDetail(_0x31848c){var _0x4747c9=soi_0x4c927d,_0x243fa8=_0x31848c['battleId'],_0xe041e1=_0x31848c[_0x4747c9(0x2b3)],_0x3596c9={},_0x233325={},_0x570271=[],_0x3b9863=_0x4747c9(0x341)+_0x243fa8,_0x16b3ef=await getDbData(_0x3b9863);if(_0x16b3ef[_0x4747c9(0x20c)]){var _0x2d530d=_0x16b3ef[0x0];_0x233325=_0x2d530d;var _0x3a5ad9=0x0,_0x5ca0b8=0x0;if(_0x2d530d[_0x4747c9(0x252)]==STATUS_LIVE_CALL_BATTLE_ONGOING){let _0x33ca91=Math[_0x4747c9(0x22f)](new Date()[_0x4747c9(0x257)]()/0x3e8);_0x3a5ad9=_0x33ca91-_0x233325[_0x4747c9(0x2a4)],_0x5ca0b8=_0x233325['total_allowed_time']-_0x3a5ad9;}else _0x2d530d[_0x4747c9(0x252)]==STATUS_LIVE_CALL_BATTLE_PENDING&&(_0x3a5ad9=0x0,_0x5ca0b8=_0x233325[_0x4747c9(0x339)]);_0x233325[_0x4747c9(0x337)]=_0x3a5ad9,_0x233325[_0x4747c9(0x338)]=_0x5ca0b8;var _0x3b9863=_0x4747c9(0x33a)+_0x2d530d[_0x4747c9(0x33b)],_0x2d05d5=await getDbData(_0x3b9863);if(_0x2d05d5[_0x4747c9(0x20c)]){var _0x12d66a=_0x2d05d5[0x0],_0x3b9863='SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20='+_0x2d530d[_0x4747c9(0x33b)]+_0x4747c9(0x33f)+_0x2d530d['id'],_0x34bd48=await getDbData(_0x3b9863),_0x2b1400=_0x34bd48[0x0],_0x7554eb=STORAGE_URL+_0x4747c9(0x297)+_0x12d66a['image'];_0x12d66a['image']==null&&(_0x7554eb=null);var _0x2a8352={'userId':_0x12d66a['id'],'username':_0x12d66a[_0x4747c9(0x22e)],'userImageUrl':_0x7554eb,'liveCallId':_0xe041e1,'battleId':_0x2d530d['id'],'isSuperHost':0x1,'totalCoin':_0x2b1400[_0x4747c9(0x33c)],'totalGift':_0x2b1400['total_gift']};_0x570271[_0x4747c9(0x251)](_0x2a8352);}var _0x3b9863=_0x4747c9(0x33a)+_0x2d530d[_0x4747c9(0x33d)],_0x20eaa7=await getDbData(_0x3b9863);if(_0x20eaa7[_0x4747c9(0x20c)]){var _0x3b9863='SELECT\x20sum(coin)\x20as\x20total_coin,\x20count(id)\x20as\x20total_gift\x20from\x20gift_history\x20where\x20gift_history.reciever_id\x20='+_0x2d530d[_0x4747c9(0x33d)]+_0x4747c9(0x33f)+_0x2d530d['id'],_0x34bd48=await getDbData(_0x3b9863),_0x2b1400=_0x34bd48[0x0],_0xd1460f=_0x20eaa7[0x0],_0x7554eb=STORAGE_URL+'/user/'+_0xd1460f['image'];_0xd1460f[_0x4747c9(0x27d)]==null&&(_0x7554eb=null);var _0x2a8352={'userId':_0xd1460f['id'],'username':_0xd1460f['username'],'userImageUrl':_0x7554eb,'liveCallId':_0xe041e1,'battleId':_0x2d530d['id'],'isSuperHost':0x0,'totalCoin':_0x2b1400[_0x4747c9(0x33c)],'totalGift':_0x2b1400[_0x4747c9(0x342)]};_0x570271[_0x4747c9(0x251)](_0x2a8352);}}return _0x3596c9[_0x4747c9(0x340)]=_0x233325,_0x3596c9['liveBattleHosts']=_0x570271,_0x3596c9;}server[soi_0x4c927d(0x343)](config[soi_0x4c927d(0x344)],()=>{var _0x405cd3=soi_0x4c927d;console[_0x405cd3(0x1f0)](_0x405cd3(0x345)+config[_0x405cd3(0x344)]);});